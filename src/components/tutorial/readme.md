# ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚·ã‚¹ãƒ†ãƒ  æ“ä½œãƒãƒ‹ãƒ¥ã‚¢ãƒ«

> **å¯¾è±¡èª­è€…**: é–‹ç™ºè€…ã€AI ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
> **æœ€çµ‚æ›´æ–°**: 2026å¹´2æœˆ2æ—¥
> **ç›®çš„**: ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ§‹é€ ã€æ“ä½œæ–¹æ³•ã€æ‹¡å¼µæ‰‹é †ã‚’ç†è§£ã™ã‚‹

---

## ğŸ“‹ ç›®æ¬¡

1. [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦](#ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦)
2. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
3. [ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ](#ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ)
4. [çŠ¶æ…‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ](#çŠ¶æ…‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ )
5. [ã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ](#ã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ )
6. [ã‚·ãƒŠãƒªã‚ªã‚·ã‚¹ãƒ†ãƒ ](#ã‚·ãƒŠãƒªã‚ªã‚·ã‚¹ãƒ†ãƒ )
7. [ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼](#ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼)
8. [æ“ä½œæ‰‹é †](#æ“ä½œæ‰‹é †)
9. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
10. [ãƒ†ã‚¹ãƒˆ](#ãƒ†ã‚¹ãƒˆ)

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã¯ã€**Phaser 3 ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³** ã¨ **React** ã‚’çµ±åˆã—ãŸã‚¹ãƒˆãƒ¼ãƒªãƒ¼é§†å‹•å‹ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’æä¾›ã—ã¾ã™ã€‚

### ä¸»è¦æ©Ÿèƒ½
- âœ… ãƒ•ã‚§ãƒ¼ã‚ºãƒ™ãƒ¼ã‚¹ã®ã‚¹ãƒˆãƒ¼ãƒªãƒ¼é€²è¡Œï¼ˆ10ãƒ•ã‚§ãƒ¼ã‚ºï¼‰
- âœ… ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•å‹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- âœ… çŠ¶æ…‹ç®¡ç†ã®ä¸€å…ƒåŒ–ï¼ˆReact + Phaserï¼‰
- âœ… ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ï¼ˆã‚¢ãƒ³ãƒ­ãƒƒã‚¯ãƒ»å­¦ç¿’ï¼‰
- âœ… ãƒãƒƒãƒ—ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼ˆ2D ã‚¿ã‚¤ãƒ«ãƒãƒƒãƒ—ï¼‰
- âœ… æ°¸ç¶šåŒ–ï¼ˆLocalStorageï¼‰
- âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- **React 18+**: UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- **Phaser 3**: ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³
- **TypeScript**: å‹å®‰å…¨æ€§
- **Vitest**: ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
- **LocalStorage**: ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 React UI Layer                       â”‚
â”‚  (tutorial-story.tsx, queen-dialogue.tsx)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  GameStateManager   â”‚ â† çŠ¶æ…‹ç®¡ç†ã®ä¸­æ¢
        â”‚  (state/)           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   EventSystem       â”‚ â† ã‚¤ãƒ™ãƒ³ãƒˆå®Ÿè¡Œã‚¨ãƒ³ã‚¸ãƒ³
        â”‚   (events/)         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Phaser MainScene   â”‚ â† ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯
        â”‚  (Ghost Component)  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ†é›¢ã®åŸå‰‡
1. **UI Layer**: React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆè¡¨ç¤ºã®ã¿ï¼‰
2. **State Layer**: çŠ¶æ…‹ç®¡ç†ï¼ˆGameStateManagerï¼‰
3. **Event Layer**: ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆEventSystemï¼‰
4. **Game Layer**: Phaser ã‚·ãƒ¼ãƒ³ï¼ˆã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³ï¼‰

---

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
tutorial/
â”œâ”€â”€ state/                    # çŠ¶æ…‹ç®¡ç†
â”‚   â”œâ”€â”€ game-state-manager.ts    # çŠ¶æ…‹ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ï¼ˆä¸­æ ¸ï¼‰
â”‚   â”œâ”€â”€ use-tutorial-state.ts    # React ãƒ•ãƒƒã‚¯
â”‚   â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ events/                   # ã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ 
â”‚   â”œâ”€â”€ event-system.ts           # ã‚¤ãƒ™ãƒ³ãƒˆå®Ÿè¡Œã‚¨ãƒ³ã‚¸ãƒ³
â”‚   â”œâ”€â”€ level01-events.ts         # ãƒ¬ãƒ™ãƒ«1ã‚¤ãƒ™ãƒ³ãƒˆå®šç¾©
â”‚   â”œâ”€â”€ types.ts                  # ã‚¤ãƒ™ãƒ³ãƒˆå‹å®šç¾©
â”‚   â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ scenarios/                # ã‚·ãƒŠãƒªã‚ªå®šç¾©
â”‚   â”œâ”€â”€ level01/
â”‚   â”‚   â”œâ”€â”€ scenes.ts             # ãƒ¬ãƒ™ãƒ«1ã‚¹ãƒˆãƒ¼ãƒªãƒ¼å°è©
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ level02/
â”‚   â”‚   â”œâ”€â”€ scenes.ts             # ãƒ¬ãƒ™ãƒ«2ã‚¹ãƒˆãƒ¼ãƒªãƒ¼å°è©
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â””â”€â”€ types.ts                  # ã‚·ãƒŠãƒªã‚ªå‹å®šç¾©
â”‚
â”œâ”€â”€ map/                      # ãƒãƒƒãƒ—ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
â”‚   â”œâ”€â”€ map-renderer.ts           # ã‚¿ã‚¤ãƒ«ãƒãƒƒãƒ—æç”»
â”‚   â”œâ”€â”€ entity-renderer.ts        # ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£æç”»
â”‚   â”œâ”€â”€ map-config.ts             # ãƒãƒƒãƒ—å®šç¾©
â”‚   â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ keywords/                 # ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ 
â”‚   â”œâ”€â”€ keyword-system.ts         # ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ç®¡ç†
â”‚   â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ persistence/              # ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–
â”‚   â”œâ”€â”€ tutorial-persistence.ts   # ä¿å­˜/èª­è¾¼ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”œâ”€â”€ local-storage-cache.ts    # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†
â”‚   â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ __tests__/                # ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ tutorial-system.test.ts   # ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ tutorial-integration.test.ts # çµ±åˆãƒ†ã‚¹ãƒˆ
â”‚
â”œâ”€â”€ tutorial-story.tsx        # ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”œâ”€â”€ tutorial-story-v2.tsx     # æ–°çµ±åˆç‰ˆï¼ˆæ¨å¥¨ï¼‰
â”œâ”€â”€ queen-dialogue.tsx        # å¥³ç‹ãƒ€ã‚¤ã‚¢ãƒ­ã‚°UI
â”œâ”€â”€ keyword-modal.tsx         # ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ€ãƒ«
â”œâ”€â”€ error-boundary.tsx        # ã‚¨ãƒ©ãƒ¼ãƒã‚¦ãƒ³ãƒ€ãƒª
â”œâ”€â”€ tutorial-keywords.data.ts # ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿
â”œâ”€â”€ IMPLEMENTATION_GUIDE.md   # å®Ÿè£…ã‚¬ã‚¤ãƒ‰ï¼ˆè©³ç´°ç‰ˆï¼‰
â””â”€â”€ readme.md                 # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

### å„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å½¹å‰²

#### `state/` - çŠ¶æ…‹ç®¡ç†
**è²¬å‹™**: ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«å…¨ä½“ã®çŠ¶æ…‹ã‚’ä¸€å…ƒç®¡ç†
- `GameStateManager`: ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã‚¯ãƒ©ã‚¹ã€å…¨çŠ¶æ…‹ã‚’ä¿æŒ
- `use-tutorial-state.ts`: React ãƒ•ãƒƒã‚¯æä¾›

#### `events/` - ã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ 
**è²¬å‹™**: æ¡ä»¶ãƒ™ãƒ¼ã‚¹ã®ã‚¤ãƒ™ãƒ³ãƒˆå®Ÿè¡Œ
- `EventSystem`: ã‚¤ãƒ™ãƒ³ãƒˆå®Ÿè¡Œã‚¨ãƒ³ã‚¸ãƒ³
- `level01-events.ts`: ã‚¤ãƒ™ãƒ³ãƒˆå®šç¾©ï¼ˆä½ç½®ãƒˆãƒªã‚¬ãƒ¼ã€ã‚¢ã‚¤ãƒ†ãƒ å–å¾—ãªã©ï¼‰

#### `scenarios/` - ã‚·ãƒŠãƒªã‚ªå®šç¾©
**è²¬å‹™**: ã‚¹ãƒˆãƒ¼ãƒªãƒ¼å°è©ã®ç®¡ç†
- `scenes.ts`: ãƒ•ã‚§ãƒ¼ã‚ºã”ã¨ã®å°è©ãƒ‡ãƒ¼ã‚¿
- `types.ts`: ã‚·ãƒŠãƒªã‚ªå‹å®šç¾©ï¼ˆSpeaker, DialogueLine ãªã©ï¼‰

#### `map/` - ãƒãƒƒãƒ—ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
**è²¬å‹™**: Phaser ã‚¿ã‚¤ãƒ«ãƒãƒƒãƒ—ã®æç”»
- `map-renderer.ts`: ã‚¿ã‚¤ãƒ«ãƒãƒƒãƒ—æç”»
- `entity-renderer.ts`: ã‚¢ã‚¤ãƒ†ãƒ ãƒ»NPCã®æç”»

#### `keywords/` - ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ 
**è²¬å‹™**: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®ã‚¢ãƒ³ãƒ­ãƒƒã‚¯ãƒ»å­¦ç¿’ç®¡ç†
- `keyword-system.ts`: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯

#### `persistence/` - æ°¸ç¶šåŒ–
**è²¬å‹™**: LocalStorage ã¸ã®ä¿å­˜ãƒ»èª­è¾¼
- `tutorial-persistence.ts`: ä¿å­˜/å¾©å…ƒAPI
- `local-storage-cache.ts`: ã‚­ãƒ£ãƒƒã‚·ãƒ¥å±¤

---

## çŠ¶æ…‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

### GameStateManager ã®çŠ¶æ…‹ä¸€è¦§

```typescript
interface TutorialGameState {
  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼
  playerPosition: { x: number; y: number };  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åº§æ¨™
  hasMap: boolean;                           // ãƒãƒƒãƒ—å–å¾—çŠ¶æ…‹

  // ã‚¹ãƒˆãƒ¼ãƒªãƒ¼é€²è¡Œ
  currentPhase: TutorialPhase;               // ç¾åœ¨ã®ãƒ•ã‚§ãƒ¼ã‚º
  lineIndex: number;                         // å°è©ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹

  // ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
  discoveredEntities: Set<string>;           // ç™ºè¦‹æ¸ˆã¿ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ID

  // UIåˆ¶å¾¡
  isPaused: boolean;                         // ä¸€æ™‚åœæ­¢çŠ¶æ…‹
  speed: "instant" | "fast" | "normal";      // ãƒ†ã‚­ã‚¹ãƒˆé€Ÿåº¦

  // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
  unlockedKeywordIds: string[];              // ã‚¢ãƒ³ãƒ­ãƒƒã‚¯æ¸ˆã¿
  learnedKeywordIds: string[];               // å­¦ç¿’æ¸ˆã¿

  // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°
  dialog: DialogState | null;                // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤ºçŠ¶æ…‹

  // ã‚¨ãƒ©ãƒ¼
  errors: TutorialError[];                   // ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°
}
```

### ãƒ•ã‚§ãƒ¼ã‚ºä¸€è¦§ï¼ˆTutorialPhaseï¼‰

```typescript
type TutorialPhase =
  | "scene1"              // 1. ã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°
  | "scene2"              // 2. ä¸–ç•Œè¦³èª¬æ˜
  | "quest"               // 3. ã‚¯ã‚¨ã‚¹ãƒˆæç¤º
  | "map_found"           // 4. ãƒãƒƒãƒ—å–å¾—
  | "explore"             // 5. æ¢ç´¢æŒ‡ç¤º
  | "return_to_queen"     // 6. å¥³ç‹ã¸ã®å ±å‘Š
  | "guide_intro"         // 7. ã‚¬ã‚¤ãƒ‰ç´¹ä»‹
  | "account_creation"    // 8. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
  | "mask_intro"          // 9. ãƒã‚¹ã‚¯èª¬æ˜
  | "end";                // 10. ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°
```

### çŠ¶æ…‹æ“ä½œAPI

```typescript
import { getGameStateManager } from "@/components/tutorial/state";

const manager = getGameStateManager();

// ãƒ•ã‚§ãƒ¼ã‚ºå¤‰æ›´
manager.goToPhase("map_found", 0);

// ãƒ©ã‚¤ãƒ³é€²è¡Œ
manager.advanceLine();

// ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½ç½®æ›´æ–°
manager.updatePlayerPosition(10, 20);

// ãƒãƒƒãƒ—å–å¾—
manager.setHasMap(true);

// ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ“ä½œ
manager.unlockKeyword("compass");
manager.learnKeyword("compass");

// ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
manager.showDialog({
  title: "å¥³ç‹",
  message: "ã‚ˆã†ã“ãï¼",
  speaker: "Queen"
});

// ã‚¨ãƒ©ãƒ¼è¿½åŠ 
manager.addError({
  code: "MAP_LOAD_FAILED",
  message: "ãƒãƒƒãƒ—èª­è¾¼ã‚¨ãƒ©ãƒ¼"
});
```

### React ãƒ•ãƒƒã‚¯

```typescript
import {
  useTutorialState,
  useTutorialPhase,
  usePlayerPosition,
  useHasMap
} from "@/components/tutorial/state";

function MyComponent() {
  // å…¨çŠ¶æ…‹ã‚’ãƒªãƒƒã‚¹ãƒ³
  const state = useTutorialState();

  // ãƒ•ã‚§ãƒ¼ã‚ºã®ã¿
  const { phase, lineIndex } = useTutorialPhase();

  // ä½ç½®ã®ã¿
  const position = usePlayerPosition();

  // ãƒãƒƒãƒ—çŠ¶æ…‹ã®ã¿
  const hasMap = useHasMap();

  return <div>ãƒ•ã‚§ãƒ¼ã‚º: {phase}</div>;
}
```

---

## ã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ 

### ã‚¤ãƒ™ãƒ³ãƒˆå®šç¾©ã®æ§‹é€ 

```typescript
interface TutorialEvent {
  id: string;                      // ã‚¤ãƒ™ãƒ³ãƒˆè­˜åˆ¥å­
  name: string;                    // ã‚¤ãƒ™ãƒ³ãƒˆå
  description?: string;            // èª¬æ˜
  trigger: TriggerCondition;       // ç™ºç«æ¡ä»¶
  actions: EventAction[];          // å®Ÿè¡Œã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  oneTime?: boolean;               // 1å›ã®ã¿å®Ÿè¡Œ
  enabled?: boolean;               // æœ‰åŠ¹/ç„¡åŠ¹
}
```

### ãƒˆãƒªã‚¬ãƒ¼æ¡ä»¶ã®ç¨®é¡

```typescript
type TriggerCondition =
  | { type: "position"; x: number; y: number; radius: number }
  | { type: "phase"; phase: TutorialPhase }
  | { type: "entity_discovered"; entityId: string }
  | { type: "keyword_unlocked"; keywordId: string }
  | { type: "always" };
```

### ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ç¨®é¡

```typescript
type EventAction =
  | { type: "goto_phase"; phase: TutorialPhase; lineIndex?: number }
  | { type: "unlock_keyword"; keywordId: string }
  | { type: "set_has_map"; value: boolean }
  | { type: "show_dialog"; title: string; message: string; speaker?: string }
  | { type: "add_entity"; entityId: string; x: number; y: number };
```

### ã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ æ–¹æ³•

**ãƒ•ã‚¡ã‚¤ãƒ«**: `events/level01-events.ts`

```typescript
export const LEVEL01_EVENTS: Record<string, TutorialEvent> = {
  // æ—¢å­˜ã®ã‚¤ãƒ™ãƒ³ãƒˆ...

  // æ–°ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 
  NEW_EVENT: {
    id: "new_event",
    name: "æ–°ã‚¤ãƒ™ãƒ³ãƒˆ",
    description: "ç‰¹å®šä½ç½®ã§ç™ºç«",
    trigger: {
      type: "position",
      x: 15,
      y: 20,
      radius: 2
    },
    actions: [
      {
        type: "show_dialog",
        title: "ç™ºè¦‹",
        message: "æ–°ã—ã„å ´æ‰€ã‚’ç™ºè¦‹ã—ãŸï¼"
      },
      {
        type: "unlock_keyword",
        keywordId: "new_keyword"
      }
    ],
    oneTime: true,  // 1å›ã®ã¿ç™ºç«
    enabled: true
  }
};
```

---

## ã‚·ãƒŠãƒªã‚ªã‚·ã‚¹ãƒ†ãƒ 

### ã‚·ãƒŠãƒªã‚ªå®šç¾©ã®æ§‹é€ 

**ãƒ•ã‚¡ã‚¤ãƒ«**: `scenarios/level01/scenes.ts`

```typescript
export const LEVEL01_CONFIG: LevelConfig = {
  id: 1,
  name: "Tutorial Level 1",
  titleJa: "ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« ãƒ¬ãƒ™ãƒ«1",
  phases: [
    "scene1", "scene2", "quest", "map_found",
    "explore", "return_to_queen", "guide_intro",
    "account_creation", "mask_intro", "end"
  ],
  scenes: {
    scene1: {
      id: "scene1",
      name: "Opening",
      speaker: "The Queen",
      lines: [
        "ã‚ˆã†ã“ãã€æ—…äººã‚ˆã€‚",
        "ã“ã“ã¯ä¾¡å€¤è¦³ã®ä¸–ç•Œã€‚",
        "ã‚ãªãŸã®æ—…ãŒå§‹ã¾ã‚‹ã€‚"
      ]
    },
    // ... ä»–ã®ã‚·ãƒ¼ãƒ³
  }
};
```

### æ–°ã—ã„ã‚·ãƒ¼ãƒ³è¿½åŠ æ–¹æ³•

1. **ãƒ•ã‚§ãƒ¼ã‚ºã‚’å®šç¾©** (`TutorialPhase` ã«è¿½åŠ )
2. **ã‚·ãƒ¼ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ** (`scenes.ts`)
3. **ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ ** (`level01-events.ts`)

```typescript
// 1. state/game-state-manager.ts
type TutorialPhase =
  | "scene1"
  | "new_scene"  // â† æ–°ãƒ•ã‚§ãƒ¼ã‚ºè¿½åŠ 
  | ...;

// 2. scenarios/level01/scenes.ts
scenes: {
  new_scene: {
    id: "new_scene",
    name: "New Scene",
    speaker: "Guide",
    lines: [
      "æ–°ã—ã„ã‚·ãƒ¼ãƒ³ã®å°è©1",
      "æ–°ã—ã„ã‚·ãƒ¼ãƒ³ã®å°è©2"
    ]
  }
}

// 3. events/level01-events.ts
NEW_SCENE_EVENT: {
  id: "new_scene_trigger",
  trigger: { type: "phase", phase: "quest" },
  actions: [
    { type: "goto_phase", phase: "new_scene", lineIndex: 0 }
  ]
}
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### ã‚³ãƒ³ãƒ‘ã‚¹è¡¨ç¤ºã®æµã‚Œï¼ˆä¾‹ï¼‰

```
1. MainScene.ts (Phaser)
   â†“ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒ map_item ã«æ¥è§¦
   â†“
2. EventSystem
   â†“ "map_acquired" ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«
   â†“ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: { type: "set_has_map", value: true }
   â†“
3. GameStateManager
   â†“ setHasMap(true) å®Ÿè¡Œ
   â†“ state.hasMap = true
   â†“ notify() ã§å…¨ãƒªã‚¹ãƒŠãƒ¼ã«é€šçŸ¥
   â†“
4. React (useTutorialState)
   â†“ hasMap ãŒ true ã«æ›´æ–°
   â†“
5. ghost-overlay.tsx
   â†“ {hasMap && <Compass />} ã§æ¡ä»¶åˆ†å²
   â†“ ã‚³ãƒ³ãƒ‘ã‚¹UIã‚’è¡¨ç¤º
```

### çŠ¶æ…‹å¤‰æ›´ã®ä¼æ’­çµŒè·¯

```
GameStateManager.updateState()
  â†“
notify() å®Ÿè¡Œ
  â†“
å…¨ listeners ã« state ã‚’é€ä¿¡
  â†“
React ãƒ•ãƒƒã‚¯ãŒå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
  â†“
UI ãŒæ›´æ–°ã•ã‚Œã‚‹
```

---

## æ“ä½œæ‰‹é †

### æ–°ã—ã„ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’è¿½åŠ ã™ã‚‹

#### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ•ã‚§ãƒ¼ã‚ºã‚’å®šç¾©
**ãƒ•ã‚¡ã‚¤ãƒ«**: `state/game-state-manager.ts`

```typescript
type TutorialPhase =
  | "scene1"
  | "my_new_phase"  // â† è¿½åŠ 
  | ...;
```

#### ã‚¹ãƒ†ãƒƒãƒ—2: ã‚·ãƒŠãƒªã‚ªã‚’è¿½åŠ 
**ãƒ•ã‚¡ã‚¤ãƒ«**: `scenarios/level01/scenes.ts`

```typescript
scenes: {
  my_new_phase: {
    id: "my_new_phase",
    name: "My New Phase",
    speaker: "Guide",
    lines: [
      "ã“ã‚Œã¯æ–°ã—ã„ãƒ•ã‚§ãƒ¼ã‚ºã§ã™ã€‚",
      "å°è©ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚"
    ]
  }
}
```

#### ã‚¹ãƒ†ãƒƒãƒ—3: ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 
**ãƒ•ã‚¡ã‚¤ãƒ«**: `events/level01-events.ts`

```typescript
MY_NEW_PHASE_TRIGGER: {
  id: "my_new_phase_trigger",
  trigger: { type: "phase", phase: "quest" },
  actions: [
    { type: "goto_phase", phase: "my_new_phase", lineIndex: 0 }
  ],
  oneTime: true
}
```

### ãƒãƒƒãƒ—ã«ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ ã™ã‚‹

**ãƒ•ã‚¡ã‚¤ãƒ«**: `map/map-config.ts`

```typescript
export const MAP_ENTITIES = [
  {
    id: "new_item",
    type: "item" as const,
    x: 15,
    y: 20,
    sprite: "star",  // ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆå
    name: "æ–°ã‚¢ã‚¤ãƒ†ãƒ "
  }
];
```

### ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹

**ãƒ•ã‚¡ã‚¤ãƒ«**: `tutorial-keywords.data.ts`

```typescript
export const TUTORIAL_KEYWORDS = [
  {
    id: "new_keyword",
    word: "æ–°ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰",
    shortDescription: "èª¬æ˜æ–‡ï¼ˆçŸ­ï¼‰",
    longDescription: "èª¬æ˜æ–‡ï¼ˆé•·ï¼‰",
    category: "system",
    relatedKeywords: []
  }
];
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚³ãƒ³ãƒ‘ã‚¹ãŒè¡¨ç¤ºã•ã‚Œãªã„

**åŸå› ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**:
1. âœ… `hasMap` ãŒ `true` ã«ãªã£ã¦ã„ã‚‹ã‹ï¼Ÿ
   - `GameStateManager.getState().hasMap` ã‚’ç¢ºèª
2. âœ… `map_item` æ¥è§¦ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ã¦ã„ã‚‹ã‹ï¼Ÿ
   - `MainScene.ts` ã®æ¥è§¦åˆ¤å®šã‚’ãƒ­ã‚°å‡ºåŠ›
3. âœ… `EventSystem` ãŒæ­£ã—ãå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‹ï¼Ÿ
   - `event-system.ts` ã§ãƒ­ã‚°ç¢ºèª
4. âœ… React å´ã«çŠ¶æ…‹ãŒä¼æ’­ã—ã¦ã„ã‚‹ã‹ï¼Ÿ
   - `useTutorialState()` ã§ `hasMap` ã®å€¤ã‚’ç¢ºèª

**ãƒ‡ãƒãƒƒã‚°æ–¹æ³•**:
```typescript
// GameStateManager ã®çŠ¶æ…‹ã‚’ç¢ºèª
const manager = getGameStateManager();
console.log("State:", manager.getState());

// ã‚¤ãƒ™ãƒ³ãƒˆå®Ÿè¡Œå±¥æ­´ã‚’ç¢ºèª
console.log("Executed Events:", eventSystem.getExecutedEvents());
```

### ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œãªã„

**ãƒã‚§ãƒƒã‚¯é …ç›®**:
1. `dialog` çŠ¶æ…‹ãŒ `null` ã§ãªã„ã‹ï¼Ÿ
2. `queen-dialogue.tsx` ãŒæ­£ã—ããƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹ã‹ï¼Ÿ
3. `z-index` ãŒä»–ã®è¦ç´ ã«éš ã‚Œã¦ã„ãªã„ã‹ï¼Ÿ

### ãƒ•ã‚§ãƒ¼ã‚ºãŒé€²ã¾ãªã„

**ãƒã‚§ãƒƒã‚¯é …ç›®**:
1. ã‚¤ãƒ™ãƒ³ãƒˆã® `trigger` æ¡ä»¶ãŒæº€ãŸã•ã‚Œã¦ã„ã‚‹ã‹ï¼Ÿ
2. ã‚¤ãƒ™ãƒ³ãƒˆãŒ `enabled: true` ã«ãªã£ã¦ã„ã‚‹ã‹ï¼Ÿ
3. `oneTime: true` ã‚¤ãƒ™ãƒ³ãƒˆãŒæ—¢ã«å®Ÿè¡Œæ¸ˆã¿ã§ãªã„ã‹ï¼Ÿ

### ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå‹•ã‹ãªã„

**ãƒã‚§ãƒƒã‚¯é …ç›®**:
1. Phaser ã‚·ãƒ¼ãƒ³ãŒæ­£ã—ãåˆæœŸåŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ï¼Ÿ
2. `isPaused` ãŒ `true` ã«ãªã£ã¦ã„ãªã„ã‹ï¼Ÿ
3. ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›ãŒæœ‰åŠ¹ã‹ï¼Ÿ

---

## ãƒ†ã‚¹ãƒˆ

### ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm run test

# ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãƒ†ã‚¹ãƒˆã®ã¿
npm run test -- src/components/tutorial/__tests__/

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
npm run test -- tutorial-system.test.ts
```

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«

#### `tutorial-system.test.ts`
- GameStateManager ã®ãƒ†ã‚¹ãƒˆ
- EventSystem ã®ãƒ†ã‚¹ãƒˆ
- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ†ã‚¹ãƒˆ

#### `tutorial-integration.test.ts`
- ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ã®ãƒ†ã‚¹ãƒˆ
- ãƒ•ã‚§ãƒ¼ã‚ºé·ç§»ã®ãƒ†ã‚¹ãƒˆ
- ã‚¤ãƒ™ãƒ³ãƒˆé€£æºã®ãƒ†ã‚¹ãƒˆ

### ãƒ†ã‚¹ãƒˆã®æ›¸ãæ–¹

```typescript
import { describe, it, expect } from "vitest";
import { GameStateManager } from "../state/game-state-manager";

describe("GameStateManager", () => {
  it("should update player position", () => {
    const manager = new GameStateManager();
    manager.updatePlayerPosition(10, 20);

    const state = manager.getState();
    expect(state.playerPosition).toEqual({ x: 10, y: 20 });
  });
});
```

---

## AI ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå‘ã‘ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®èª­ã¿æ–¹

1. **æ§‹é€ ã‚’ç†è§£ã™ã‚‹**: ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã‹ã‚‰å…¨ä½“åƒã‚’æŠŠæ¡
2. **çŠ¶æ…‹ç®¡ç†ã‚’æŠŠæ¡**: `GameStateManager` ã® API ã‚’ç¢ºèª
3. **ã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã‚’ç†è§£**: ãƒˆãƒªã‚¬ãƒ¼ã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ä»•çµ„ã¿ã‚’å­¦ã¶
4. **ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã‚’è¿½ã†**: ã‚³ãƒ³ãƒ‘ã‚¹è¡¨ç¤ºã®ä¾‹ã§å‡¦ç†ã®æµã‚Œã‚’ç†è§£
5. **æ“ä½œæ‰‹é †ã‚’å®Ÿè¡Œ**: æ–°è¦è¿½åŠ ã®æ‰‹é †ã«å¾“ã£ã¦å®Ÿè£…

### å¤‰æ›´æ™‚ã®æ³¨æ„ç‚¹

1. **å‹å®šç¾©ã‚’ç¢ºèª**: TypeScript ã®å‹ã«å¾“ã†
2. **æ—¢å­˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¸è¥²**: æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç¶­æŒ
3. **ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ**: å¤‰æ›´å¾Œã¯å¿…ãšãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
4. **çŠ¶æ…‹ã®ä¸€è²«æ€§**: GameStateManager çµŒç”±ã§çŠ¶æ…‹ã‚’å¤‰æ›´
5. **ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•**: ç›´æ¥çŠ¶æ…‹ã‚’å¤‰æ›´ã›ãšã€ã‚¤ãƒ™ãƒ³ãƒˆçµŒç”±ã§å¤‰æ›´

### ã‚ˆãã‚ã‚‹è³ªå•

**Q: tutorial-story.tsx ã¨ tutorial-story-v2.tsx ã®é•ã„ã¯ï¼Ÿ**
A: v2 ã¯æ–°ã—ã„çµ±åˆç‰ˆã€‚ä»Šå¾Œã¯ v2 ã‚’ä½¿ç”¨æ¨å¥¨ã€‚

**Q: Phaser ã¨ React ã®çŠ¶æ…‹ã‚’åŒæœŸã™ã‚‹æ–¹æ³•ã¯ï¼Ÿ**
A: `GameStateManager` ã‚’ä¸­ç¶™ç‚¹ã¨ã—ã¦ä½¿ç”¨ã€‚

**Q: æ–°ã—ã„ãƒ¬ãƒ™ãƒ«ã‚’è¿½åŠ ã™ã‚‹ã«ã¯ï¼Ÿ**
A: `scenarios/level02/` ã‚’å‚è€ƒã«æ–°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã€‚

---

## å‚è€ƒè³‡æ–™

- **è©³ç´°å®Ÿè£…ã‚¬ã‚¤ãƒ‰**: [IMPLEMENTATION_GUIDE.md](./IMPLEMENTATION_GUIDE.md)
- **Phaser 3 ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: https://photonstorm.github.io/phaser3-docs/
- **React ãƒ•ãƒƒã‚¯**: https://react.dev/reference/react

---

## æ›´æ–°å±¥æ­´

- **2026-02-02**: åŒ…æ‹¬çš„ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã«åˆ·æ–°ï¼ˆAIå‘ã‘æ§‹é€ åŒ–ï¼‰
- **2026-01-XX**: ã‚³ãƒ³ãƒ‘ã‚¹è¡¨ç¤ºã®èª¬æ˜è¿½åŠ 
- **2026-01-XX**: åˆç‰ˆä½œæˆ
