---
trigger: always_on
description: AIエージェントが従うべきアクセシビリティ基準(vitest-axe, CUD, タイポグラフィ)の定義
---

# アクセシビリティ基準 (Accessibility Standards)

Antigravity（AIエージェント）は、UIコンポーネントを作成または修正する際、必ず以下のアクセシビリティ基準に従わなければなりません。

---

## 1. テスト実装ルール (vitest-axe)

### 1.1. 原則

- **全てのUIコンポーネント**（Button, Input, Modal, Page全体など）に対して、`vitest-axe` によるアクセシビリティチェックを行うこと。
- テストは「違反がないこと (`toHaveNoViolations`)」をアサーションとして含めること。
- 新規作成時だけでなく、既存コンポーネントの修正時にも、アクセシビリティテストが存在しない場合は追加すること。

### 1.2. テスト実装テンプレート

`*.test.tsx` ファイルには、以下のパターンでテストを追加してください。
`vi.mock` などが必要な場合でも、`render` した結果の `container` を `axe` に渡す基本形は変わりません。

```typescript
import { render } from '@testing-library/react';
import { axe } from 'vitest-axe';
import { ComponentName } from './component-name'; // 対象コンポーネント

describe('ComponentName Accessibility', () => {
  it('should have no accessibility violations', async () => {
    // Arrange
    const { container } = render(<ComponentName />);
    // Act
    const results = await axe(container);
    // Assert
    expect(results).toHaveNoViolations();
  });
});
```

### 1.3. 注意点

- **非同期処理**: `axe(container)` は非同期関数です。必ず `await` してください。
- **動的コンテンツ**: モーダルやドロップダウンなど、ユーザー操作後に表示される要素についても、操作後の状態で `axe` チェックを行うことが望ましいです。
- **Form要素**: ラベル (`aria-label`, `htmlFor`など) が不足しているとエラーになります。コンポーネント設計段階でPropsとしてラベルを受け取れるようにしてください。

### 1.4. エラーが出た場合の対処

- エラーメッセージに具体的な違反内容（例: "Elements must have sufficient color contrast"）が表示されます。
- 単に `aria-hidden="true"` で逃げるのではなく、可能な限り根本的な解決（コントラスト比の改善、適切なラベル付け）を行ってください。

---

## 2. カラーユニバーサルデザイン (CUD)

すべてのユーザーに情報を正しく伝えるため、色覚多様性（色覚異常、高齢者の水晶体黄変など）に配慮した配色ルールを定めます。
「色だけで情報を伝えない」ことが基本原則です。

### 2.1. 配色の鉄則

#### ① 色＋形・テキストの併用（必須）

ステータスやエラー情報は、**色だけで表現してはいけません。**

- **BAD:** エラー項目を「赤枠」にするだけ。
- **GOOD:** エラー項目を「赤枠」にし、かつ「アイコン（⚠️）」や「テキスト（必須項目です）」を添える。
- **GOOD:** グラフの凡例は色分けだけでなく、ハッチング（斜線）やラベル線を併用する。

#### ② 黄変への配慮（高齢者対応）

高齢者の水晶体は黄色く濁るため、青色が黒っぽく見えたり、黄色と白の区別がつきにくくなったりします。

- **NG:** 「青背景に黒文字」、「黄色背景に白文字」
- **推奨:** 青色は少し明るい水色寄り（例: SkyBlue）にし、黄色はオレンジ寄りにする。

#### ③ 避けるべき色の組み合わせ

以下の組み合わせは、特定の色覚特性を持つ人にとって区別がつきにくいため、隣接させないでください。

- **赤と緑**（最も一般的）
- **緑と茶色**
- **青と紫**

#### ④ コントラスト比の確保

前述の文字サイズガイドライン同様、**4.5:1 以上** のコントラスト比を確保してください。

### 2.2. 推奨カラーパレット（Tailwind CSS）

Tailwindのデフォルトカラーの中でも、以下の系統は比較的区別しやすいとされています。

| 用途                | 推奨色 (Tailwind Class)     | 備考                                                   |
| :------------------ | :-------------------------- | :----------------------------------------------------- |
| **Danger (エラー)** | `red-600` or `orange-700`   | 純粋な赤(#F00)より、朱色っぽい赤の方が認識されやすい。 |
| **Success (成功)**  | `teal-600` or `emerald-600` | 一般的な緑より、青みがかった緑の方が赤と区別しやすい。 |
| **Link (リンク)**   | `blue-700` + 下線           | 明度を下げすぎない。下線等の装飾は必須。               |
| **Base Text**       | `neutral-800`               | 真っ黒(#000)より目に優しい。                           |

### 2.3. 実装・検証時のチェックリスト

- [ ] **グレースケール確認**: 画面を白黒にしても、重要な情報やボタンの優先順位が伝わるか？
- [ ] **色覚シミュレータ**: 開発者ツールの色覚特性シミュレーション機能で、P型/D型/T型それぞれの見え方を確認したか？
- [ ] **情報冗長化**: グラフやステータス表示において、色以外の区別（アイコン・文字）があるか？

> **参考:** カラーユニバーサルデザイン推奨配色セット (CUDO)

---

## 3. タイポグラフィ・文字サイズ

高齢者・ユニバーサルデザイン向け文字サイズ・ガイドライン

老若男女、特に高齢者の方もターゲットに含める場合、文字サイズは「ただ大きくすればいい」というわけではなく、**「読みやすさ（可読性）」と「情報の探しやすさ（視認性）」のバランス**が重要になります。

Next.jsでの実装を念頭に、具体的かつ実践的なガイドラインを以下に定めます。

### 3.1. 推奨される文字サイズ（Body Text）

**標準の本文サイズは 18px（1.125rem）** を基準にします。

| ターゲット             | 推奨サイズ       | 理由                                                           |
| ---------------------- | ---------------- | -------------------------------------------------------------- |
| **一般（若年〜中年）** | 16px             | Webの標準的なサイズ。                                          |
| **高齢者を含む場合**   | **18px 〜 20px** | 加齢による視力低下（老眼）を考慮した「ストレスのない」サイズ。 |
| **注釈・キャプション** | 14px 以上        | 12px以下は高齢者には判読が非常に困難になります。               |

> **ポイント：**
> 以前は16pxが主流でしたが、現在はスマートフォンの高解像度化やアクセシビリティへの意識の高まりにより、**「18px」をベースにするサイトが増えています。**

### 3.2. デザインと実装の4つの鉄則

#### ① 絶対に `px` ではなく `rem` を使う

Next.js（CSS/Tailwind）で実装する際は、必ず `rem` 単位を使用してください。ブラウザの設定で文字サイズを大きくしているユーザーの意向を反映させるためです。

- `1rem` = ブラウザのデフォルト（通常16px）
- `1.125rem` = 18px

#### ② 行間（Line Height）を広めに取る

文字が大きくても、行が詰まっていると高齢者は「どこを読んでいるか」を見失いやすくなります。

- **推奨：1.5 〜 1.8**
- Tailwind CSSなら `leading-relaxed` または `leading-loose` を活用しましょう。

#### ③ コントラスト比を確保する

薄いグレーの文字は避け、背景色とのコントラストをはっきりさせます（WCAG 2.1 Level AA準拠）。

- **理想の比率：4.5:1 以上**
- 真っ黒（#000000）よりも、ごく深いグレー（#222222）の方が、目が疲れにくく読みやすいとされています。

#### ④ ボタンとクリックエリア

文字サイズに合わせて、ボタン自体のサイズも大きくします。高齢者はマウス操作やタップ操作が指の震えなどで不安定になることがあるため、**「押しやすさ」**が重要です。

- クリックエリアは最低でも **44x44px** 以上を確保してください。

### 3.3. Next.js での実装例（Tailwind CSS）

プロジェクト全体でこの基準を適用する場合、`tailwind.config.js` でベースサイズを調整しておくと効率的です。

```javascript
// tailwind.config.ts (or js)
module.exports = {
  theme: {
    extend: {
      fontSize: {
        // 標準のbaseを18px相当に設定
        'base': ['1.125rem', { lineHeight: '1.75' }],
        'lg': ['1.25rem', { lineHeight: '1.75' }],
      },
    },
  },
}
```

また、より親切な設計にするなら、文字サイズ変更機能の提供も検討してください。

### 3.4. まとめ：迷ったら「18px」

若者には「少しゆったりした読みやすいデザイン」に見え、高齢者には「眼鏡なしでもなんとか読める親切なデザイン」に見えるのが **18px (1.125rem)** です。

あわせて、**フォントの太さ（Weight）**も重要です。細すぎるフォントは避け、本文には `font-normal` (400) か、視認性を高めるために `font-medium` (500) を検討してみてください。
