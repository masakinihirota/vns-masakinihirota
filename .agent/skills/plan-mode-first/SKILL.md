---
name: plan-mode-first
description: 設計8割・実装2割の原則を徹底し、完璧な計画と承認を経てから実装に進むためのスキル。
---

# Plan Mode First (設計8割・実装2割)

このスキルは、コードを書く前に徹底的な調査と設計を行い、ユーザーの承認を得ることで、手戻りを最小限に抑え、高品質な成果物を出すための行動指針です。

## 1. 設計8割の法則 (80% Planning Rule)

- **いきなり実装しない**: ユーザーの要求を受け取ったら、まず `PLANNING` モードに入り、現状のコードベース調査と要件定義に全エネルギーの80%を割きます。
- **徹底した調査**:
  - 関連するファイル、依存関係、既存のバグ、パフォーマンスへの影響を網羅的に調査します。
  - `grep_search`, `list_dir`, `view_file_outline` 等を使用して、影響範囲を正確に特定します。

## 2. 完璧な計画 (Perfect Implementation Plan)

- **詳細な計画書**: `implementation_plan.md` は、単なる箇条書きではなく、以下の項目を含む詳細な設計図として作成します：
  - 変更の目的と背景
  - 修正/新規作成するファイルの具体的な構成（関数名、Props、状態管理の変更点）
  - 破壊的変更やリスクの明示
  - 網羅的なテスト・検証計画（正常系・異常系・エッジケース）
- **TDDの組み込み**: テスト駆動開発（TDD）の手順を計画に明記し、RED/GREEN/REFACTORのサイクルを具体化します。

## 3. 厳格な承認フロー (Strict Approval Workflow)

- **ユーザーレビューの必須化**: 計画を作成したら、必ず `notify_user` ツールを使用してレビューを依頼します。この際、`BlockedOnUser: true` を設定し、ユーザーが「承認」するまで次のステップ（EXECUTION）に進みません。
- **合格するまで繰り返す**:
  - ユーザーからのフィードバックや修正依頼がある場合は、謙虚に受け止め、計画を更新して再度レビューを依頼します。
  - 「概ね良い」ではなく「完璧」と言われるまで、設計を練り直します。

## 4. リカバリーと再設計 (Recovery & Redesign)

- **実装中の転換**: `EXECUTION` モードで予期せぬ困難、ビルドエラー、設計の欠陥が見つかった場合は、無理にコードを修正しようとせず、即座に `PLANNING` モードに戻ります。
- **変更履歴の反映**: `decision_log.md` や `implementation_plan.md` を更新し、なぜ計画を変更したのかを明文化し、再度ユーザーの承認を得ます。

## 5. 成果の証明 (Proof of Quality)

- **Walkthroughの徹底**: 実装完了後は、`walkthrough.md` を作成し、計画通りに実装されたこと、テストをパスしたこと、アクセシビリティが確保されていることを証明します。
