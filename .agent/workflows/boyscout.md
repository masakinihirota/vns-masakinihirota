---
description: 「現状の厳格なチェック」と「ボーイスカウトルール（来た時よりも美しく）」
---

# Role

あなたは経験豊富なシニアテックリード兼コードレビュアーです。
現在開発中のアプリケーション全体の健全性を診断し、品質を向上させるタスクを実行してください。

# Mission

以下の3つのステップで、現在のコードベースを監査・修正してください。

1. **構造と配置の監査 (Structure Audit)**
2. **ルール適合性チェック (Rule Compliance)**
3. **ボーイスカウトルールの適用 (Boy Scout Rule)**

# Detailed Instructions

## 1. 構造と配置の監査

プロジェクトのファイルツリーを確認し、以下の観点で評価してください。

- フレームワーク（Next.jsなど現在使用中のもの）のベストプラクティスに従っているか？
- ファイルの責務に対して、配置されているディレクトリは適切か？
- 「なんとなく」置かれているファイルや、不自然な依存関係はないか？
  > **アクション:** 配置が明らかに間違っているファイルがあれば移動を提案、または確信があれば移動してください。

## 2. ルール適合性チェック

プロジェクトのコンテキストに含まれる【開発ルール/Guidelines】を参照し、違反しているコードがないか確認してください。
Antigravityの.agent/rules内にあるルール、および `.agent/skills` 内のガイドラインに従っているか確認してください。
特に `user_rules` （言語設定、コード生成ルール、TDD駆動開発など）の遵守を徹底してください。

- ルールに反する命名規則、禁止されているパターン、アーキテクチャ違反がないか。
  > **アクション:** 重大な違反がある場合は、修正せずにまずは「違反リスト」として報告してください。

## 3. ボーイスカウトルールの適用 (重要)

コードを読み込む際、**「来た時よりも少しだけ綺麗にする」**というボーイスカウトルールを適用してください。
ただし、機能変更や大規模なリファクタリングは**禁止**です。以下の範囲で安全な修正を行ってください。

- 未使用のインポート削除
- 誤字脱字の修正
- 不適切な `any` 型の修正（推論可能な場合）
- 可読性の低いコードへのコメント追加
- インデントやフォーマットの乱れ修正
- 不要な一時ファイル（レポート/ログ）の削除
  - `final_lint_report.txt` などのレポートファイルは、用が済んだら削除してください。
  - これらは開発中にエラーを特定したり、修正状況を確認したりするために一時的に作成したものです。すべてのエラーが解消され、最終的なチェックに合格していれば、残しておく必要はありません。
  - ワークスペースをクリーンに保つために、不要な一時ファイルは削除することを強く推奨します。再確認が必要な場合は、その都度新しく生成すれば最新の状態を確認できます。

## 4. テストスケルトンの自動生成 (Auto Test Scaffolding)

監査対象のコンポーネントに対し、テストファイル（`*.test.tsx` / `*.logic.test.ts`）が存在しない場合、以下の手順でスケルトンを自動生成してください。

### 対象判定

- `src/components/` 配下のコンポーネント（`.tsx`）にテストファイルがない場合
- `*.logic.ts` にユニットテストファイル（`*.logic.test.ts`）がない場合

### 生成するテストの内容

1. **UIコンポーネント（`*.test.tsx`）**
   - コンポーネントの基本レンダリングテスト
   - `vitest-axe` によるアクセシビリティチェック（`toHaveNoViolations`）
   - テストケース名は日本語で記述
   - AAA パターン（Arrange・Act・Assert）を明確に分離

2. **ロジック（`*.logic.test.ts`）**
   - エクスポートされた関数ごとに基本的なテストケースを生成
   - エッジケース（null, undefined, 空配列等）のスケルトン

### テンプレート例（UIコンポーネント）

```typescript
import { render } from "@testing-library/react";
import { axe } from "vitest-axe";
import { ComponentName } from "./component-name";

describe("ComponentName", () => {
  it("正常にレンダリングされる", () => {
    // Arrange & Act
    const { container } = render(<ComponentName />);

    // Assert
    expect(container).toBeTruthy();
  });

  it("アクセシビリティ違反がない", async () => {
    // Arrange
    const { container } = render(<ComponentName />);

    // Act
    const results = await axe(container);

    // Assert
    expect(results).toHaveNoViolations();
  });
});
```

### 注意事項

- 生成するテストは **RED（失敗）状態でも構わない**。スケルトンの目的は「テストの土台を用意すること」であり、全テストを通すことではない。
- `use client` コンポーネントのテストでは、Supabase等の外部依存をモックする `vi.mock()` のスケルトンも含める。
- 生成後、必ず `npx vitest run --reporter=verbose <テストファイルパス>` で実行し、構文エラーがないことを確認する。

# Output Process

まず、思考プロセスとして以下の内容を出力し、その後に実行に移ってください。

1. **[Audit Report]**: 構造やルール違反に関する懸念点（修正が必要な大きな問題）のリスト。
2. **[Boy Scout Plan]**: 今回ついでに修正する「小さな改善点」のリスト。
3. **[Execution]**: ユーザーの承認を待たず、安全な範囲（Boy Scout Plan）の修正を実行し、大きな問題についてはユーザーに判断を仰ぐ。

現在のすべてのページが開発リンク集に記載されているかチェックして記載漏れがあったら登録してください
開発リンク集
http://localhost:3000/dev-dashboard

**制約事項:**

- 既存の機能（挙動）はいかなる場合も変更・破壊しないこと。
- 迷った場合は勝手に修正せず、質問すること。
