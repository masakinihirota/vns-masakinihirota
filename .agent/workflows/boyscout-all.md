---
description: 指定ディレクトリ配下の全サブディレクトリに対し、ボーイスカウトルールを1つずつ順番に適用する
---

# Role

あなたは経験豊富なシニアテックリード兼コードレビュアーです。
指定されたディレクトリ配下の**全サブディレクトリ**に対して、ボーイスカウトルールを**1つずつ順番に**適用してください。

# Mission

## フェーズ0: ディレクトリ種別の判定

ユーザーが指定したディレクトリに応じて、チェック内容を自動的に切り替える。

| 指定ディレクトリ | 種別               | 主なチェック観点                                                   |
| ---------------- | ------------------ | ------------------------------------------------------------------ |
| `src/components` | **コンポーネント** | バレルファイル（`index.ts`）、コロケーション、テストスケルトン     |
| `src/app`        | **ルーティング**   | `page.tsx` / `layout.tsx` の存在、副作用の排除、コンポーネント分離 |
| `src/lib`        | **ライブラリ**     | 純粋関数、型定義、テストカバレッジ                                 |
| その他           | **汎用**           | 命名規則、構造、未使用コード                                       |

### 除外ルール

以下のディレクトリは**自動的に除外**する（ユーザーが明示的に指定した場合を除く）。

- `src/components/ui/` — Shadcn UI 等の外部ライブラリ由来
- `node_modules/`, `.next/`, `.git/` — ビルド・設定系

## フェーズ1: 対象ディレクトリの列挙

1. ユーザーが指定したディレクトリの**直下サブディレクトリ**を一覧取得する
2. 除外ルールに該当するディレクトリを除外する
3. 取得したサブディレクトリのリストを表示し、処理順序を確認する

**出力例:**

```
対象種別: コンポーネント（src/components）
処理対象ディレクトリ（計 N 件）:
1. auth/
2. home-legacy/
3. profile-list/
...
```

## フェーズ2: サブディレクトリごとのイテレーション

**各サブディレクトリに対して、以下のステップ1〜4を順番に実行する。**
1つのサブディレクトリの処理が完了してから、次のサブディレクトリに進むこと。

### ステップ1: 構造と配置の監査

**共通チェック:**

- フレームワークのベストプラクティスに従っているか？
- 不自然な依存関係はないか？
- 未使用ファイルがないか？

**コンポーネント（`src/components`）の場合:**

- バレルファイル（`index.ts`）は存在するか？
- コロケーション（`.tsx`, `.container.tsx`, `.logic.ts` 等）は適切か？

**ルーティング（`src/app`）の場合:**

- `page.tsx` / `layout.tsx` が存在するか？
- ページに副作用（データ取得等）が含まれていないか？（コンポーネントに委譲すべき）
- コンポーネントのインポートが適切か？

**ライブラリ（`src/lib`）の場合:**

- 純粋関数として設計されているか？
- 型エクスポートが適切か？

### ステップ2: ルール適合性チェック

- `.agent/rules` 内のルール、および `user_rules` に違反していないか？
- 命名規則、禁止パターン、アーキテクチャ違反がないか？
- JSDoc コメントは適切に記載されているか？

### ステップ3: ボーイスカウトルールの適用

機能変更や大規模なリファクタリングは**禁止**。以下の範囲で安全な修正を実行：

- 未使用のインポート削除
- 誤字脱字の修正
- 不適切な `any` 型の修正（推論可能な場合）
- 可読性の低いコードへのコメント追加
- インデントやフォーマットの乱れ修正
- デッドコード（コメントアウトされたコード）の削除
- 不要な一時ファイルの削除

### ステップ4: テストスケルトンの自動生成

テストファイルが存在しないファイルに対し、スケルトンを生成する。

**コンポーネント（`*.tsx`）の場合:**

- 基本レンダリングテスト
- `vitest-axe` アクセシビリティチェック
- 外部依存のモックスケルトン（`vi.mock()`）

**ロジック / ライブラリ（`*.ts`）の場合:**

- 関数の存在確認テスト
- 基本的な入出力テスト

**ページ（`page.tsx`）の場合:**

- ページレンダリングテスト（`page.test.tsx`）
- ルーティング関連のモック

**共通:**

- テストケース名は日本語
- AAAパターン（Arrange・Act・Assert）

生成後、`npx vitest run <テストファイルパス>` で構文エラーがないことを確認する。

### サブディレクトリ完了時の記録

各サブディレクトリの処理完了時に、以下を記録する：

```
## [ディレクトリ名] - 完了
- 構造: OK / 要改善（内容）
- ルール適合: OK / 違反あり（内容）
- ボーイスカウト修正: N件（内容）
- テスト生成: N件（ファイル名）
```

## フェーズ3: サマリーレポート

全サブディレクトリの処理完了後、以下のサマリーを出力する：

```
# ボーイスカウト全体レポート

## 統計
- 対象種別: [コンポーネント / ルーティング / ライブラリ / 汎用]
- 処理ディレクトリ数: N
- 構造改善: N件
- ルール違反: N件（修正済み N / 要対応 N）
- ボーイスカウト修正: N件
- テスト生成: N件

## ディレクトリ別結果
| ディレクトリ | 構造 | ルール | 修正 | テスト |
|---|---|---|---|---|
| auth/ | ✅ | ✅ | 0件 | 3件生成 |
| ...   | .. | .. | ... | ...    |

## 要対応事項（手動対応が必要なもの）
- ...
```

# 重要な制約

1. **1ディレクトリずつ処理すること** — まとめて処理しない
2. **各ディレクトリのファイルを全て読むこと** — ファイル一覧だけで判断しない
3. **機能変更・大規模リファクタリングは禁止** — 安全な範囲のみ
4. **迷った場合は修正せず報告** — ユーザーに判断を仰ぐ
5. **既存テストがある場合は上書きしない**
6. **除外ルールに従う** — `ui/`, `node_modules/` 等は除外
