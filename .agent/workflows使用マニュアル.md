# Antigravity Workflows ガイド

このディレクトリには、AIエージェント（Antigravity）が実行するタスクの手順書（Workflow）を格納します。
作成したMarkdownファイルは、チャット上でスラッシュコマンド（`/filename`）として呼び出すことができます。

## 1. Workflowの作成方法

### ファイルの配置場所

- ディレクトリ: `.agent/workflows/`
- ファイル名: `[コマンド名].md`
  - 例: `deploy.md` を作成すると `/deploy` コマンドとして使用可能になります。

### ファイルフォーマット

Markdown形式で記述します。先頭には必ず YAML Frontmatter で説明（description）を記述してください。

```markdown
---
description: コマンドの簡単な説明（チャット欄の補完リストに表示されます）
---

# ここから下にAIへの指示を記述します

具体的な手順やルールをMarkdownで記述してください。
箇条書きや番号付きリストを使うとAIが理解しやすくなります。

1. 現状を確認する
2. コードを修正する
3. テストを実行する
```

## 2. 引数（Arguments）の使い方

Workflowにはプログラムのような厳密な変数定義（例: `$1`, `{arg}`）はありません。
AIは **「Workflowの指示内容」** と **「チャットでのユーザー入力」** を組み合わせて解釈します。

### 呼び出し例

チャットで以下のように入力した場合：
`> /refactor src/components/button.tsx を関数コンポーネントに書き換えて`

### Workflowファイル側の書き方

指示文の中で「ユーザーが指定した対象」や「入力された内容」を参照するように自然言語で記述します。

> **書き方の例:**
>
> - 「ユーザーが**指定したファイル**の内容を確認し、リファクタリングを行ってください。」
> - 「**入力された指示**に従ってコードを修正し、コミットしてください。」
> - 「引数で**対象ディレクトリ**が指定されていない場合は、カレントディレクトリを使用してください。」

## 3. 自動実行（Turbo Mode）

通常、コマンドライン操作（`run_command`）はユーザーの承認が必要ですが、以下の注釈を使うと承認をスキップできます。

### 単一ステップの自動化 (`// turbo`)

特定のステップの直前に記述します。

```markdown
1. 必要なディレクトリを作成します
// turbo
2. パッケージをインストールします (`npm install`)
```

### 全ステップの自動化 (`// turbo-all`)

ファイル内のどこかに記述すると、そのWorkflow実行中の全てのコマンド操作が自動承認されます。
（信頼性の高い定型作業に推奨されます）

```markdown
// turbo-all

このワークフローは全てのコマンドを自動実行します。
```

### ⚠️ 自動実行が動作しない場合

`// turbo` はシステム的な強制力を持つものではなく、**「AIに対して `SafeToAutoRun: true` オプションを使うよう指示するコメント」**です。
そのため、以下のような理由で動作しない（承認ダイアログが出る）場合があります。

1. **AIの判断**: コマンドの内容が破壊的であるとAIが判断した場合、安全のために指示を無視して承認を求めることがあります。
2. **AIの見落とし**: AIがコメントを読み飛ばして、通常の実行（`SafeToAutoRun: false`）を行ってしまう場合があります。

**対処法:**
動作しない場合は、チャットで**「turboモードで実行して」「確認画面を出さずにやって」**と追記して再実行させてください。

## 4. 実践的なテクニック

### コンテキストの活用

Workflowは実行時に**「現在開いているファイル」**や**「直前のチャット履歴」**も参照します。
これを利用して、以下のような柔軟な指示が可能です。

- 「現在開いているファイルをテストしてください」
- 「さっきの議論に基づいて、このファイルを修正してください」

### インタラクティブな動作

Workflowの途中でAIが判断に迷った場合や、危険な操作が必要な場合は、チャットでユーザーに確認（`ask_followup_question`）や承認（`run_command`の承認待ち）を求めます。
完全に全自動ではなく、**「人とAIの協調作業」**のテンプレートとして機能します。

### ステップの分割

複雑なタスクは、1つのWorkflowに詰め込むよりも、小さなステップに分けて番号付きリストで記述すると成功率が上がります。

```markdown
1. XXをチェックする
2. 問題があればYYを修正する
3. 最後にZZを実行して確認する
```

## 5. 既存のWorkflow一覧

現在利用可能なコマンドは、このディレクトリ（`.agent/workflows/`）内の `.md` ファイルを確認してください。
