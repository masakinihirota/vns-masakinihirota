用語

グループ
フリーズ
ドリフト
ミュート
リーブ
注意
警告
イエローカード
レッドカード
アナザーディメンション



## Next.jsとSupabaseを用いたRLS/RBACグループ機能要件定義書

### I. はじめに

#### 1.1. 目的
本要件定義の目的は、VNS「masakinihirota」におけるグループ機能（オアシス）を、**クリエイターの保護**と**幸福追求権の優先**という基本原則 に則り、Next.jsおよびSupabaseを用いて安全かつ拡張性高く実装することにあります。特に、ユーザーの役割（ロール）に基づいた厳格なアクセス制御（RBAC）と、データベース層でのデータ保護（RLS）の実現を定義します。

#### 1.2. 採用技術スタック
*   **フロントエンド:** Next.js (App Router), React, TypeScript。
*   **バックエンド/データベース:** Supabase (PostgreSQL, Auth, RLS)。
*   **権限管理:** RLS (Supabase/PostgreSQL) および RBAC。

### II. グループ機能（オアシス）の要件

#### 2.1. グループの基本構造
1.  **グループの作成:** ユーザー認証後、**ユーザープロフィール**を作成した際、そのユーザープロフィールに紐づく**最小グループ**が自動的に作成され、当該ユーザーが自動的に**リーダー**となります。
2.  **グループの規模:** 1グループあたりの人数は制限されます（例: 1～10人）。
3.  **階層構造:** グループ（オアシス）のリーダーは、複数のグループをまとめ、より大きな「**それ以上のまとまり**」（村、町、市など）を階層的に形成できます（ボトムアップ方式）。
4.  **グループルール:** グループには、基本ルールとして**オアシス宣言の遵守**が自動的に適用されます。

オアシス宣言など基本的な価値観をコアにしたグループを用意します。
このグループは上限はなく誰でも入れる特別なグループになります。
言うなればトップダウン形式のグループになります。
これはシステムが用意する特別なグループです。

* オアシス宣言のグループ
	条件は1つだけ
	オアシス宣言を守る人
	リーダーは管理人
	警告その他、フリーズ、ドリフト 等の処罰があります。

* 人間宣言のグループ
	条件は1つだけ
	人間宣言を守るだけ
	リーダーは管理人
	警告その他、フリーズ、ドリフト 等の処罰があります。



#### 2.2. メンバー管理と参加方法
1.  **参加方法:** ユーザーはマッチングを通じて価値観の合う人を見つけ、「ウォッチ」や「フォロー」を選択し、相手がフォローバック（相互フォロー）することでグループメンバーとして追加されます。
2.  **参加単位:** グループに参加する際は、自身の**ユーザープロフィールのみ**が参加します。

### III. セキュリティ要件：RLSとRBACによるアクセス制御

RLSとRBACは、VNSのセキュリティ設計（優先度:高）の核となります。

#### 3.1. RLS（行レベルセキュリティ）の活用
SupabaseのコアであるPostgreSQLの機能としてRLSを最大限に活用します。

1.  **データアクセス制御:** RLSにより、認証されたユーザーが「**自分に関係のある情報や、見ることを許された情報だけ**」に触れるようにデータベース自身が賢く制御します。
2.  **開発の簡素化:** 複雑な情報の流れもRLSによってデータベース側で制御されるため、アプリケーション開発がシンプルになります。
3.  **実装場所:** RLSはデータアクセスに利用されます 。

#### 3.2. RBAC（ロールベースアクセス制御）の定義

RBACは、グループ内およびシステム全体でのユーザーの**役割**に応じて、実行可能な「力（権限）」を定義します。

| 役割（ロール） | 概要と立ち位置 | 主な権限（力）と責務 | 関連する技術的要素 |
| :--- | :--- | :--- | :--- |
| **グループのリーダー** | グループ（オアシス）のすべての責任を負う者。 | グループ情報の編集（名前、ルール）。**仲間の招待、承認、別れを告げること（メンバー管理）**。メンバーに対する**ペナルティ（警告、リーブ、アナザーディメンションなど）を課す全権限**。 | Next.js Server Actionsによる最終検証。グループテーブルでのRLSポリシー。 |
| **マネージャー** | リーダー権限の一部を代行する者。 | メンバーの追加、メンバーを外す（除名）。 | リーダー権限の**移譲は不可**（重要権限を除く一部移譲は可能）。 |
| **グループのメンバー** | グループの一員で、リーダーとウォッチ以上の関係にある者。 | 自身の投稿、作品の表現（投稿、編集、削除）。仲間の言葉や作品の閲覧。**リーダーを評価**すること。 | RLSにより、グループ内の情報アクセスを制限。 |
| **認証済みユーザー** | ログインし、ルートアカウントを持つユーザー。 | 自身のルートアカウントおよびユーザープロフィールの作成・管理。作品の登録・評価。 | ルートアカウントID、所持ポイント（一元管理）。 |
| **管理人 (Admin)** | 世界全体を見守り維持する運営側の役割。 | すべてのユーザーアカウントの管理、システム設定の変更、不適切な行為の監視、**すべてのログと情報へのアクセス**。 | AdminUsersテーブル。管理者ダッシュボード (`/admin` ルート)。 |

#### 3.3. Next.jsアプリケーション層での制御

データベース層のRLSに加え、アプリケーション層でもセキュリティを確保します。

1.  **UIの表示制御:** リーダーのみに表示すべき機能（例：メンバー追加/削除ボタン、グループルール設定メニュー）は、ユーザーの役割情報を確認した上で、**クライアント側（Next.js/React）で出し分け**ます。
2.  **サーバー側での最終検証:** ユーザーがアクション（例：メンバー削除）を試みた際、**Next.jsのServer Actions**などのサーバー側ロジックで、そのユーザーがデータベース上の正式なリーダーであるかを再度検証し、クライアントの改ざんを防ぎます。

### IV. システム実装の具体的な要素

#### 4.1. 認証と役割連携
*   **認証方式:** OAuth認証（Google、GitHub等）を利用したアカウント作成・ログイン機能を採用します。
*   **権限付与:** 権限とアクセス制御には、SupabaseのRLSを活用した**RBAC（ロールベースアクセス制御）**が原則となります。
*   **ルートアカウント:** 認証済みユーザーにはシステム全体で一意の「ルートアカウント」が1つ付与され、ポイントなどのリソースを一元管理します。ユーザープロフィールはこのルートアカウントのポイントに依存します。

#### 4.2. 開発環境とテスト
*   **開発/テスト環境:** Supabaseの「プレビュー環境」や「開発環境」機能、およびテスト専用のデータベースを活用することが推奨されます。
*   **セキュリティテスト:** RLSによるアクセス制御が有効かを確認するため、セキュリティテストを実施します。特に「**他の人の情報が勝手に見えてしまわないか？**」といった脆弱性を確認することが重要です。



----------------------------------------

1. **価値観ベースの自動マッチング**: 人数バランスより価値観の一致を優先

1.1 基本原則
- **幸福追求権の優先**: 表現の自由より幸福追求権を優先（日本国憲法第13条 > 第21条）
- **クリエイター保護**: コンテンツ創造者の権利と利益を最優先
- **ヘイト発言等の禁止**: ネガティブな発言やヘイトスピーチは禁止
- **ボトムアップ方式**: 少数のグループから拡大していく構造
- **価値観の一致**: マッチングの基本は価値観、対立するグループは自動調整で分離












**核心的な設計方針**:
1. **価値観ベースの自動マッチング**: 人数バランスより価値観の一致を優先
2. **50%ルールによる自動スケーリング**: グループ許容量の50%超過で上位階層へ自動移行
3. **リーダー兼任システム**: 選ばれたリーダーのみが上位階層を兼任
4. **メンバーの所属は最小グループのみ**: 階層移動はリーダーのみが行う

---

---

## 1. 基本方針：オアシス宣言との整合性

### 1.1 VNSの基本原則
- **幸福追求権の優先**: 表現の自由より幸福追求権を優先（日本国憲法第13条 > 第21条）
- **クリエイター保護**: コンテンツ創造者の権利と利益を最優先
- **ヘイト発言等の禁止**: ネガティブな発言やヘイトスピーチは禁止
- **ボトムアップ方式**: 少数のグループから拡大していく構造
- **価値観の一致**: マッチングの基本は価値観、対立するグループは自動調整で分離

### 1.2 リーダーの全権限
ユーザープロフィール作成者は自動的に最小グループのリーダーとなり、以下の全権限を持つ：
- グループ情報（名前、ルール）の編集
- メンバーの招待、承認、削除
- ペナルティの賦課（イエローカード、レッドカード、ミュート、リーブ、アナザーディメンション）
- 上位階層への参加・作成の決定

---

## 2. グループの基本構造

### 2.1 グループの定義
- **最大人数**: 10人まで
- **構成**: リーダー1人 + メンバー最大9人
- **作成**: ユーザープロフィール作成時に自動生成
- **マッチング方式**: 価値観ベースの自動マッチング（1日1回）

### 2.2 価値観マッチングの仕組み
1. **ユーザープロフィールの作成**: 認証後、活動用プロフィールを作成
2. **価値観の回答**: ベーシックな価値観質問に回答（マッチングの必須条件）
3. **目的設定**: 仕事、遊び、婚活などの目的を設定
4. **自動マッチング**: システムが価値観の一致度を点数化し、近い人をマッチング
5. **Tier評価の活用**: ユーザーが作品に付与したTier 1/2/3評価も考慮

### 2.3 人数バランスの考え方
- **価値観優先**: 人数バランスより価値観の一致を優先
- **結果**: グループによって人数に偏りが生じる（これは自然な結果）
- **調整**: AIが価値観対立グループを自動調整し、安全なオアシスを維持

---

## 3. 自動スケーリング：50%ルール

### 3.1 グループから村への移行
```
トリガー条件: グループ人数が許容量（10人）の50%超過
↓
実行: 6人以上になったら自動で「村（Village）」に昇格
```

**移行時の構造**:
- **村のリーダー**: グループのリーダーAが兼任
- **グループのリーダー**: リーダーA（継続）
- **メンバー**: グループにとどまる（村には所属しない）
- **結果**: 村 = リーダーAのみ、グループ = リーダーA + メンバー9人

### 3.2 村から町への移行
```
トリガー条件: 村の許容量（10グループリーダー）の50%超過
↓
実行: 6グループリーダー以上になったら自動で「町（Town）」に昇格
```

**リーダー選出方法**:
1. **自動選出**: 価値観、信頼度、活動実績に基づきシステムが自動選出
2. **手動選出**: リーダーたちの合議や投票で決定
3. **選ばれたリーダーのみ**: 町のリーダーとして上位階層に移動
4. リーダーを誰もやらない場合は昇格しないでそのままの階層を維持します。誰もリーダーをやりたくないならそのままです。

**移行時の構造**:
- **町のリーダー**: 選ばれたリーダーB（自分の村のリーダーを兼任）
- **村の構成**: グループリーダーA, B, C, D, E, F...（Bが代表）
- **グループ構成**: 各リーダー配下のメンバーは各グループにとどまる

リーダーに不満だったら、村を離れて新しいグループで活動して、次の村を探す。


---

## 4. リーダーの役割と責任

### 4.1 単一グループリーダー（レベル1）
**権限**:
- グループ名、説明、ルールの設定・変更
- メンバー招待（フォロワーから選択）
- 参加申請の承認・却下
- メンバー削除（リーブ）
- ペナルティ付与（連続経過日数ポイントのリセット）

**責任**:
- オアシス宣言の遵守確保
- グループ内の秩序維持
- トラブル調停

### 4.2 村リーダー（レベル3）兼任
**追加権限**:
- 新しいグループリーダーの受け入れ・却下
- 村全体のルール設定
- 上位階層（町）への参加申請

**構成**: 村はグループリーダーのみで構成される

### 4.3 町リーダー（レベル4）兼任
**選出方法**:
- 自動マッチング選択時: システムが自動選出
- 手動選択時: 村のリーダーたちによる合議/投票

**役割**:
- 町全体の代表
- 村のリーダー + グループのリーダーを兼任
- 上位階層（市）への参加申請

### 4.4 リーダー兼任の構造
```
[例: リーダーAの場合]
- グループリーダー（10人のグループを管理）
- 村リーダー（6つのグループを統括）
- 町リーダー（6つの村を統括）
  ↓
実際の所属:
- グループメンバー: グループにのみ所属
- 村のリーダーたち: 各自のグループを管理しつつ、村の構成員
- 町のリーダー（A）: 町の代表として上位階層に接続
```

---

## 5. メンバーの役割と制限

### 5.1 メンバーの権限
- グループ内での投稿・コメント
- リーダーの評価（信頼度など）相互評価

### 5.2 メンバーの制限
- **階層移動なし**: メンバーは最小グループ（レベル1）にのみ所属
- グループ管理機能へのアクセス不可
- 他メンバーへのペナルティ付与不可
- グループルールの変更不可
- メンバーの追加・削除不可

### 5.3 メンバーになる条件
- リーダーとの間に「フォロー」以上の関係が必要
- フォロー: メンバー参加申請
  - オープングループ: 自動承認
  - クローズドグループ: リーダー承認が必要

---

## 6. ルール設定の考え方

### 6.1 グループローカルルール
リーダーが設定できる独自ルール例：
- **新規メンバー基準**: 招待/承認の判断基準
- **ペナルティ基準**: どのような行為が対象か明確化

---

## 8. UI/UX への影響

### 8.1 ダッシュボード表示
```
[リーダーAのダッシュボード]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 あなたの役割
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🌍 町リーダー（Town - レベル4）
   └─ 6つの村を統括

🏘️ 村リーダー（Village - レベル3）
   └─ 6つのグループを統括

🏠 グループリーダー（Group - レベル1）
   └─ 10人のメンバーを管理
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⚠️ 自動スケーリング通知
グループ「クリエイター集団」が50%に到達しました。
次回メンバー追加で村レベルに自動昇格します。
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 8.2 階層移動の通知
- メンバー: 「あなたのグループが村に昇格しました！」
- リーダー: 「おめでとうございます！あなたは村のリーダーにもなりました」
- 自動マッチング: 「価値観マッチングにより、町のリーダーに選出されました」

### 8.3 階層構造の可視化
- ツリービュー: ユーザーが所属する階層を視覚的に表示
- パンくずリスト: グループ → 村 → 町 のナビゲーション
- 統計情報: 各階層の人数、活動状況、価値観スコア

---

## 9. セキュリティとバランスの確保

### 9.1 権限の分散防止
- **1プロフィール = 最大1つのリーダー起源**: 初期グループのリーダー権限は固定
- **兼任は昇格のみ**: 下位階層のリーダーとして上位階層を兼任
- **選出による制限**: 町以上のリーダーは選出制で権力集中を防ぐ

### 9.2 価値観対立の自動調整
- AIが価値観スコアを計算し、対立グループを自動分離
- 上位階層形成時、価値観の一致度が閾値以下のグループは別の階層へ

### 9.3 ペナルティシステムとの統合
- リーダーの権限濫用: 上位リーダーがペナルティを課せる
- メンバーからの評価: リーダーの信頼度スコアで監視
- 自動降格: 信頼度が閾値以下になるとリーダー権限剥奪の可能性

---

## 10. 未解決の課題と今後の検討事項

### 10.1 リーダー選出の詳細
- [ ] **自動選出のアルゴリズム**: 価値観、信頼度、活動実績の重み付け
- [ ] **手動選出の投票方式**: 単純多数決か、価値観重み付け投票か
- [ ] **選出期間**: リーダー任期の設定（永続 or 定期改選）

### 10.2 リーダー不在時の対応
- [ ] **一時不在**: 副リーダー制度の導入
- [ ] **永久不在**: メンバーからの立候補制度
- [ ] **グループ解散**: 一定期間リーダー不在でグループを自動解散

### 10.3 階層間の権限移譲
- [ ] **権限の委譲**: 上位リーダーが下位リーダーに権限を委譲できるか
- [ ] **権限の剥奪**: 上位リーダーが下位リーダーの権限を剥奪できるか
- [ ] **紛争解決**: 階層間の対立をどう調停するか

### 10.4 スケーリングの調整
- [ ] **50%ルールの妥当性**: 実運用でのフィードバックに基づく調整
- [ ] **階層ごとの閾値**: レベルによって異なる閾値を設定する必要性
- [ ] **手動スケーリング**: リーダーが任意でスケーリングを実行できるオプション

### 10.5 メンバーの階層認識
- [ ] **階層の可視性**: メンバーは自分のグループがどの階層に属するか知るべきか
- [ ] **上位階層への関心**: メンバーが上位階層の情報を閲覧できるか
- [ ] **階層移動の申請**: メンバーが直接上位階層への参加を希望できるか

---

## 11. VNS設計との整合性確認

### 11.1 完全一致する設計要素
✅ **価値観ベースのマッチング**: VNSの核心理念と一致
✅ **ボトムアップ方式**: 少数グループから拡大
✅ **リーダーの全権限**: グループルール設定の自由
✅ **オアシス宣言の遵守**: 安全な環境作り
✅ **階層構造**: Group → Village → Town → City...

### 11.2 拡張・調整が必要な要素
🔧 **50%ルールの明文化**: 要件定義書に追加が必要
🔧 **リーダー兼任の詳細**: データベーススキーマに反映
🔧 **自動スケーリングロジック**: サーバーアクションの実装
🔧 **階層移動UI**: ダッシュボード設計への反映

### 11.3 矛盾なし・調整不要
- メンバーの所属範囲（最小グループのみ）
- 価値観対立の自動調整
- リーダー選出方式（自動/手動）

---

## 12. 次のステップ

### 12.1 要件定義書への反映
1. **アクセス権限要件定義書**: 50%ルール、リーダー兼任を追加
2. **グループ管理要件定義書**: 自動スケーリングの詳細を記載
3. **マッチング要件定義書**: 階層別マッチングロジックを明記

### 12.2 設計書の作成・更新
1. **データベース設計書**: テーブル構造の拡張を反映
2. **API設計書**: 自動スケーリングエンドポイントの追加
3. **UI設計書**: 階層ダッシュボード、通知の設計

### 12.3 プロトタイプ実装
1. **フェーズ1**: グループの基本機能（最大10人、リーダー権限）
2. **フェーズ2**: 50%ルールによる自動スケーリング
3. **フェーズ3**: 村・町レベルのリーダー選出機能
4. **フェーズ4**: 全階層の統合テスト

---

## 13. 参考資料

### 13.1 関連ドキュメント
- [0012-01-アクセス権限要件定義書.md](../0020 個別機能 大 -01要件定義書 -02設計書 -03テスト計画書/0012-01-アクセス権限要件定義書.md)
- [0014-02-RBAC グループと役割要件定義書.md](../0020 個別機能 大 -01要件定義書 -02設計書 -03テスト計画書/0014-02-RBAC グループと役割要件定義書.md)
- [0010-01-全体要件定義書.md](./0010-01-全体要件定義書.md)

### 13.2 技術参考
- Supabase Row Level Security（階層別権限制御）
- PostgreSQL Recursive Queries（階層構造クエリ）
- Next.js Server Actions（自動スケーリングロジック）

---

## 14. 変更履歴

| 日付 | 変更内容 | 担当者 |
|------|----------|--------|
| 2025-10-08 | 初版作成：AI壁打ちの記録を整理整頓 | masakinihirota |

---

## 📌 重要な結論

この壁打ちで確立された**「50%ルールによる自動スケーリング」**は、VNSの設計思想と完全に一致し、以下の利点をもたらします：

1. **シンプルで明確**: 誰でも理解できる自動ルール
2. **価値観優先**: 人数より価値観の一致を重視
3. **リーダー負担軽減**: 自動スケーリングでリーダーの判断負荷を削減
4. **コミュニティの自然成長**: ボトムアップで健全に拡大
5. **権限の明確化**: リーダー兼任により責任の所在が明確

このルールを要件定義書に正式に組み込み、実装に進むことを強く推奨します。

---

## 💡 AIからの追加アドバイス

### 懸念点と対策
1. **リーダーの負担過多**: 複数階層を兼任するリーダーの負荷 → 副リーダー制度や権限委譲の検討
2. **スケーリングの頻度**: 50%が低すぎて頻繁にスケーリングが発生する可能性 → 実運用で閾値を調整
3. **メンバーの疎外感**: 階層が上がるにつれてリーダーとの距離が遠くなる → グループ内コミュニケーション機能の強化

### 優先度の高い実装項目
1. **自動スケーリングの通知システム**: リーダーとメンバーへの明確な通知
2. **階層ダッシュボード**: リーダーが全階層を一覧できるUI
3. **価値観マッチングの精度向上**: 階層が上がっても価値観の一致を保つアルゴリズム

---

**このメモは生きたドキュメントです。実装やテスト結果に基づいて随時更新してください。**

---

## 壁打ちの元の内容（参考用）

<details>
<summary>クリックして展開</summary>

ユーザーが作るグループ このグループのルールを壁打ちして詰めていきたいです。

お問い合わせありがとうございます。VNS（Value Network Service）「masakinihirota」におけるユーザーが作るグループのルール設定（掟/ルール）について、システムの設計思想とリーダーの権限に基づき、壁打ちをさせていただきます。
このサービスでは、グループのリーダーに大きな裁量と責任が与えられており、その権限を用いて具体的なルールを策定・執行することが基本となります。
VNSにおけるグループ運営ルールの基本枠組み
グループのルールを検討するにあたり、すべてのユーザーとグループが遵守すべきシステム全体の基本原則と、グループのリーダーが設定できるローカルなルールの権限範囲を理解することが重要です。
1. すべてのグループに適用される基本原則（オアシス宣言）
グループ運営のルールを考える際、まず**「オアシス宣言」**の遵守が必須となります。これはVNSがインターネット上に「安心・安全なオアシス」を作るという目的に基づいています。
基本原則
詳細と目的
参照元
幸福追求権の優先
表現の自由（日本国憲法:第21条）と幸福追求権（日本国憲法:第13条）が衝突する場合、必ず幸福追求権を優先します。
クリエイターの保護
幸福追求権の優先は、コンテンツを創造するクリエイターの権利と利益を最優先することを意味します。
ヘイト発言等の禁止
ネガティブな発言やヘイトスピーチは禁止されます。
ボトムアップ方式
VNSは、少数のグループでの運営と拡大を基本とするボトムアップ方式を採用しています。
価値観の一致
グループは自身の価値観をベースにマッチングされ、価値観が対立するグループ同士は、より大きなまとまり（村、町など）に自動的に結合されないよう調整されます。
2. グループリーダーの権限とルール設定（掟）
ユーザープロフィールを作成した者は自動的に最小グループのリーダーとなり、そのグループの「すべての責任を負う者」となります。
リーダーがグループ情報（名前、掟/ルールなど）を編集する権限を持ちます。
壁打ちの論点A：リーダーがグループルールで何を定めるべきか？
リーダーは、メンバーの活動制御を行うための全権限を持っています。グループ独自のルール（掟）は、この権限を運用するための具体的な指針となるでしょう。
リーダーが持つ主なルール執行権限
ルール策定時に考慮すべき点
参照元
メンバー管理
仲間の招待、承認、別れを告げること（メンバー削除）が可能です。グループの目的に合わないメンバーをどう判断するか、ルールに明記できます。
ペナルティの賦課
メンバーに対してペナルティ（警告、ミュート、リーブ、アナザーディメンションなど）を課すことができます。ペナルティは、メンバーの**「連続経過日数ポイント」をリセット**する形で機能します。
ペナルティの基準
どのような行為がペナルティの対象となるか（例：ネガティブな発言、過度な他者批判、グループの目的に反する行動など）をルール（掟）として明確に定める必要があります。
3. グループのルールと活動目標
グループは「価値観でのつながり」を作ることを目的とし、そのプロフィール作成時には「仕事、遊び、婚活など」の目的設定を行います。ルールは、その目的達成を支援する内容であるべきです。
壁打ちの論点B：価値観と行動のルール化
グループのルールを詰めるにあたり、どのような価値観や行動を重視するかを明確にすることが、グループの目的に沿ったメンバー集めに繋がります。
検討すべきルール項目
システムとの連携
参照元
評価ルールの設定
グループ内で作品を評価する際の文化を設定します。システムは作品に対する「好き」の度合いをTier 1〜3で絶対相対評価することを求めています。
情報公開の基準
メンバーが自分のプロフィール情報をどこまで公開するか（名刺、履歴書、フル表示切替など）について、グループ内での推奨基準を設けます。
ポイント使用ルール
ポイントはマッチング、コメント、拍手、グループ作成などで消費されます。グループの活動（例：拍手での称賛を奨励する）に合わせて、ポイントの使い方に関する推奨事項を設定できます。
新規メンバーの招待/承認基準
マッチングはシステムにより自動または手動で行われますが、リーダーがメンバーとして追加する際の判断基準（例：ベーシックの価値観をすべて回答していること、または特定のスキル登録）を定めることができます。
4. 拡張時のルール適用
グループは少数（1〜10人程度）から始まり、リーダーが主体となって複数のグループをまとめ、「村 (Village)」「町 (Town)」「市 (City)」といったそれ以上のまとまりを形成することが可能です。
壁打ちの論点C：まとまり（Village, Town, City）への拡大とルールの連鎖
• より大きなまとまり（Village, Town, City）が形成された場合、そのまとまりのリーダー（参加グループのリーダーたちによって構成される）が、新しいルールを設定する権限を持ちます。
• 既存のグループのローカルルール（掟）と、まとまり全体のルールがどのように共存し、または優先されるのかを設計することが、拡張時の安定性に寄与します。
これらの情報に基づき、グループの性質（例：仕事仲間探し、趣味の共有、婚活）に合わせて、どの権限を強く適用し、どのような行為を推奨または禁止するかの具体的なルールを詰めていくことができます。
まず自分の理想とするルールを聞いて下さい、要件定義書と違うかもしれませんが理想とするルールが、今こっちのほうがいいというアイデアが出てきています。そのルールを優先したいです。グループの統廃合についてです。０から考えていきます。＞まず基本としてグループは最大１０人までで受け入れます。、そのグループはリーダーとメンバーで構成されています。

ご提示いただいた理想のルールについて、VNS（Value Network Service）の設計思想に基づき、壁打ちをさせていただきます。
要件定義書の内容と異なる**「今こっちのほうがいいというアイデア」を優先したいというご要望、承知いたしました。VNSでは、グループのリーダーにグループの「掟/ルール」を編集する全権限**が与えられているため、システム全体の基本原則（オアシス宣言）に反しない限り、リーダーの理想とするルールを運用することが可能です。
まずは、ご提示いただいた基本構造と、それに関連するVNSの設計について確認し、次に具体的な「統廃合」のルール案を深掘りしていきましょう。

--------------------------------------------------------------------------------
1. グループの基本構造の確認
ユーザーの理想とする基本構造
1. グループは最大10人までで受け入れます。
2. そのグループはリーダーとメンバーで構成されています。
VNS設計との整合性
この基本構造は、VNSの設計と完全に一致しています。
• グループの規模と構成： VNSでは、ユーザープロフィール作成時に自動的に最小のグループが作成され、その作成者がリーダーとなります。グループ規模は1～10人程度を想定されており、1種類の集合あたり最大10人までで構成できます。
• リーダーの権限： リーダーは「グループのすべての責任を負う者」であり、グループ情報（名前、掟/ルールなど）の編集や、仲間の招待、承認、別れを告げること（メンバー削除）、そしてメンバーへのペナルティを課す全権限を持ちます。
• メンバーの役割： メンバーはグループの一員として、自身の投稿や作品の表現を行い、リーダーを評価することができます。

--------------------------------------------------------------------------------
2. 壁打ちテーマ：グループの統廃合（スケーリング）
「統廃合」（グループの結合と拡張）に関しては、VNSはボトムアップ方式を採用しており、リーダーの権限が強く関わる部分です。
VNSにおける統廃合のメカニズム
グループが拡大していく際、以下の原則が適用されます。
1. ボトムアップ方式の採用: VNSは、少数のグループでの運営と拡大を基本とするボトムアップ方式でコミュニティを形成します。
2. 階層的な拡大: リーダーは、複数のグループをまとめ、階層的に村 (Village)、町 (Town)、**市 (City)**などへと拡大できます。
3. まとまりのリーダー構成: それ以上のまとまり（Village, Town, City）のリーダーは、参加するグループのリーダーたちによって構成されます。
4. 価値観による自動調整: AIや計算の力を借りて、価値観が対立するグループ同士は同じグループに入れないように、自動的にグループの結合の調整が行われます。これは、インターネット上に「安心・安全なオアシス」を作るという目的に沿っています。
統廃合に関する理想のルールを定めるための論点
リーダーが「統廃合」や「拡大」に関して独自の理想ルール（掟）を定める場合、以下のどの側面に焦点を当てるかをご提示ください。
理想のルールに関する質問A：招待・結合の基準
統廃合（他のグループとの結合、または新しいメンバーの受け入れ）において、リーダーとしてどのような基準を優先したいですか？
検討事項
VNSの仕組みとの関連
ルールの継承と優劣
結合する際、自グループの「掟/ルール」と、上位のまとまり（村、町など）のルール、どちらが優先されるべきか？
価値観の一致度
結合を希望する相手グループに対し、システムが算出した価値観の一致度（スコア/ランク） 以外に、どのような定性的な基準（例：グループの目的の一致、スキル登録の有無）を要求するか？
リーダーの資質
新しいまとまりのリーダー構成員となる人物（他のグループリーダー）に求める資質や、リーダーを評価する基準 を独自に設けるか？
理想のルールに関する質問B：ペナルティと離脱（統廃合の解消）
統廃合後に、問題が発生した場合の対処法について、どのようなルールを理想としますか？
検討事項
VNSの仕組みとの関連
グループ排除の基準
他のグループが、ネガティブな発言やヘイトスピーチ 以外の理由（例：活動が極端に低調、目的の不履行）で、まとまりからの離脱（統廃合の解消）を求める際の具体的な基準。
ペナルティのポイント消費
まとまり全体のリーダーが、構成員であるグループリーダーに対してペナルティを課す際に、ペナルティによる連続経過日数ポイントのリセット 以外の措置を独自に定めたいか？（※ポイント消費はルートアカウントで一元管理されます。）
ぜひ、今頭に浮かんでいるグループの統廃合に関する具体的なアイデアや理想のルールをご提示ください。その内容が、VNSのシステム設計（特にリーダーの全権限 とボトムアップ方式）とどのように連携し、実現可能か、深く掘り下げて壁打ちを続けます。
基本的にグループは自動マッチングを採用しています。 そのためにはユーザーの価値観を表すユーザープロフィールを作成してもらい。なるべく近い価値観の人と自動でマッチングをします。

いただいた理想のルール（グループの基本原則）について、VNS（Value Network Service）「masakinihirota」の設計思想に基づき、そのいただいた理想のルール（グループの基本原則）について、VNS（Value Network Service）「masakinihirota」の設計思想に基づき、その実現可能性と詳細について確認いたします。
ご提示いただいた内容は、VNSの中核となる設計方針と完全に一致しています。
1. VNSにおける自動マッチングの基本構造
VNS「masakinihirota」は、SNS（Social Network Service）ではなく**VNS（Value Network Service）**として、価値観でのつながりを作るサービスとして定義されています。
1.1 価値観をベースとしたマッチングの採用
ご提示の通り、VNSでは基本的にグループは自動マッチングを採用しています。
このサービスは、ユーザーの自身の価値観をベースにマッチングしてグループを作ることを目的としています。これは、ユーザーが同じ価値観、趣味、仕事、悩み、環境を共有する人を探すことを支援するためです。
1.2 ユーザープロフィールと価値観の紐付け
マッチングを実現するため、ユーザーには価値観を表すユーザープロフィールを作成してもらうことが必須です。
1. ユーザープロフィールの作成: 認証を終えたユーザーは、活動するためのユーザープロフィールを作成します。一つのルートアカウントで複数の活動側面（千の仮面）を持つことが可能です。
2. 価値観の回答: ユーザープロフィールには、ユーザーの価値観を表明し、それをマッチングの基礎データとするために、価値観の回答が紐付けられます。
3. マッチングの起点: プロフィールの作成時には、目的設定（仕事、遊び、婚活など）も行われ、目的が合うユーザー同士がマッチング対象となります。
4. 手動マッチングの前提条件: 手動マッチングを行う場合、ユーザーはベーシックの価値観をすべて回答している必要があります。
1.3 近い価値観を持つ人とのマッチング方法
システムは、なるべく近い価値観の人と自動でマッチングさせるアルゴリズムを採用しています。
• 自動マッチングの実行: 「マッチングボタン」を押すことで、1日1回自動でマッチングが実行されます。
• 類似性の算出基準: 候補者の算出にあたっては、以下の要素が利用され、類似性の高いユーザーを抽出します。
    ◦ 価値観の一致度を点数化し、スコア/ランクで表示します。
    ◦ ユーザーが作品に付与した**ティア評価（Tier 1/2/3）**も重要な要素となります。
    ◦ 重要価値観のみでマッチングを絞ることも可能です。
2. グループ運営における自動マッチングの重要性
自動マッチングによって形成されたグループは、その後のコミュニティ運営においても重要な役割を果たします。
• グループの自動作成: ユーザープロフィール作成と同時に、そのユーザーをリーダーとする最小のグループを自動で生成します。
• 価値観の対立の調整: AIや計算の力を借りて、価値観が対立するグループ同士は同じグループに入れないように、自動的にグループの結合の調整が行われます。これは、「インターネット上に、安心・安全なオアシスを作る」というVNSの目的を達成するために不可欠な機能です。
• ボトムアップ方式の基盤: マッチングにより少数グループが形成され、その後、リーダーが主体となってグループを拡大していくボトムアップ方式が採用されています。
ご提示いただいた「価値観に基づいた自動マッチング」は、VNSの設計の根幹であり、クリエイターの権利と利益を最優先し、幸福追求権を優先するという基本理念 を実現するための仕組みです。
人数のバランス、グループは自動マッチングで作成され、近い価値観があればそのグループにいれます。価値観で判断すると当然人数のバランスが崩れます。グループの上限１０人以上になる前の５０％を超えると自動的に一つ上の階層に自動で移動します。メンバーはそのままで、リーダーがその階層のリーダーになります。一つ上の階層、この例だと村とグループのリーダを兼ねています。構成は村のリーダーA一人、グループのリーダーA一人 残りのグループメンバーで構成されます。 メンバーは上の階層に所属しません。グループにとどまります。

素晴らしいアイデアありがとうございます。ご提示いただいた人数のバランスに基づいた自動的な階層移動（統廃合）のルールは、VNS（Value Network Service）「masakinihirota」のボトムアップ方式の設計思想と、リーダーの全権限を効果的に活用するものであり、非常に実現性が高いと考えられます。
いただいた要件について、VNSの設計との整合性を確認しながら壁打ちを行います。

--------------------------------------------------------------------------------
提案ルールの壁打ちとVNS設計との整合性
1. 価値観に基づくマッチングと人数のバランス
【ユーザー様の提案】 グループは自動マッチングで作成され、近い価値観があればそのグループにいれます。価値観で判断すると当然人数のバランスが崩れます。
【VNS設計との整合性】 完全に一致しています。 VNSは、ユーザーの価値観でのつながりを作ることを目的とし、自身の価値観をベースにマッチングしてグループを作成します。マッチングは、ユーザープロフィールの作成と価値観の回答に基づき、1日1回自動で実行されます。
また、VNSはAIや計算の力を借りて、価値観が対立するグループ同士は同じグループに入れないように、自動的にグループの結合の調整を行う仕組みを備えており、「安心・安全なオアシス」を作ることを目指しています。この設計は、人数のバランスよりも価値観の一致を優先するため、人数の偏りが発生することは自然な結果となります。
2. グループの階層移動と自動スケーリング（50%ルール）
【ユーザー様の提案】 グループの上限１０人以上になる前の５０％を超えると自動的に一つ上の階層に自動で移動します。
【VNS設計との整合性】 VNSでは、グループ規模は1～10人程度を想定しています。グループのリーダーは、グループの**「掟/ルール」を編集する全権限**を持ちます。
この「50%を超えたら（6人以上になったら）自動で上位階層へ移動する」というルールは、グループリーダーが定める**「掟/ルール」**として設定することで、コミュニティの拡大戦略として運用可能です。
VNSの設計はボトムアップ方式を採用しており、リーダーは複数のグループをまとめ、階層的に村 (Village)、町 (Town)、**市 (City)**などへと拡大できます。この50%ルールは、グループが活性化した際の自動的な拡張トリガーとして機能し、ボトムアップでの拡大を促す非常に合理的な仕組みです。
3. リーダーの役割兼任とメンバーの所属範囲
【ユーザー様の提案】 メンバーはそのままで、リーダーがその階層のリーダーになります。一つ上の階層、この例だと村とグループのリーダーを兼ねています。構成は村のリーダーA一人、グループのリーダーA一人、残りのグループメンバーで構成されます。メンバーは上の階層に所属しません。グループにとどまります。
【VNS設計との整合性】 これはVNSの階層構造とリーダーシップの定義と合致しており、非常に明確な運用ルールです。
1. リーダーの兼任: グループのリーダーは、「それ以上のまとまり（Village, Town, City）」を形成する際、そのまとまりのリーダー構成員となります。ご提案の通り、リーダー（A）が元のグループ（10人以下）の責任者である役割を維持しつつ、新しく形成された村のリーダーとしての役割を兼任することは、ボトムアップ方式の基本構造に則っています。
2. メンバーの所属: VNSにおいて「それ以上のまとまり」は、参加グループのリーダーたちによって構成されます。つまり、まとまりを構成するのはグループそのものと、それを代表するリーダー陣であり、個々のグループのメンバーが直接的に上の階層（村、町など）に所属する必要はありません。メンバーが所属するグループ内で活動を完結し、リーダーが上の階層への連絡窓口となるこの設計は、VNSの構造をシンプルに保つ上で理想的です。
このルールを採用することで、グループ内のメンバーは自身の所属グループ（オアシス）での活動に集中でき、一方でリーダーは上位階層でのルール設定や調整に専念できるという、役割分担の明確化が図れます。
自然と村はグループのリーダーばかりになります。そのむらでもリーダーの価値観に近い人が自動でマッチングします。その村の許容量の５０％を超えたら町に階層が一つ上がります。その時誰が町のリーダーになるかを決めます。自動マッチングを選んでいた場合は自動でなります。選ばれたリーダーだけが一つ上の階層に移動します。これを繰り返してきます。

ご提示いただいた、グループの拡大とリーダーの選出に関するルール（統廃合のメカニズム）ボトムアップ方式と、リーダーの全権限を最大限に活かす、非常に論理的で効果的な設計であると考えられます。
VNSの設計思想と照らし合わせながら、壁打ちをさせていただきます。

--------------------------------------------------------------------------------
提案ルールの構造とVNS設計との整合性
1. 村の構成とリーダーのマッチング
提案の構造
自然と村はグループのリーダーばかりになります。その村でもリーダーの価値観に近い人が自動でマッチングします。
VNS設計との整合性
これはVNSの階層構造と完全に一致しています。
• リーダーによる構成: VNSでは、グループのリーダーが複数のグループをまとめ、「それ以上のまとまり」（村 (Village)、町 (Town)、市 (City) など）を形成します。このまとまりのリーダーは、参加グループのリーダーたちによって構成されます。したがって、村がグループリーダーのみで構成されるのは自然な結果です。
• 価値観に基づくマッチングの継続: VNSは価値観でのつながりを作るサービス（VNS）であり、ユーザーは自身の価値観をベースにマッチングしてグループを作ることが目的です。この原則は、リーダーたちが集まった村の階層でも適用されます。リーダー自身の価値観プロフィール を基に、より近い価値観を持つ他のリーダーと自動でマッチングし、まとまり（村）の価値観を純粋に保ちます。システムは価値観が対立するグループ同士は同じグループに入れないように、自動的にグループの結合の調整を行います。
2. 自動スケーリングのトリガーと上位階層への移動
提案の構造
その村の許容量の５０％を超えたら町に階層が一つ上がります。その時誰が町のリーダーになるかを決めます。
VNS設計との整合性
「50%を超えたら自動的に上位階層へスケーリングする」というルールは、グループリーダーが設定できる**「掟/ルール」**として有効に機能します。
• ボトムアップ方式の推進: VNSはボトムアップ方式を採用し、少数のグループ運営から拡大していくのが基本です。グループ規模は1～10人程度が想定されています。この50%ルール（村の構成員であるグループリーダーが5〜6人を超えたら自動スケーリング）は、コミュニティが成熟した際の自動的な拡張と秩序維持を促す理想的なトリガーとなります。
• ルールの設定権: グループのリーダーは、グループ情報（名前、掟/ルールなど）を編集する全権限を持っています。このルールは、上位のまとまり（村、町）のリーダーも設定可能です。
3. リーダーの選出と役割の引き継ぎ
提案の構造
自動マッチングを選んでいた場合は自動でなります。選ばれたリーダーだけが一つ上の階層に移動します。これを繰り返してきます。
VNS設計との整合性
この「選出されたリーダーのみが次の階層を兼任し、上位階層を構成する」という考え方は、VNSの階層的な役割定義と整合します。
1. リーダー選出（自動/手動）: VNSでは、マッチングは自動（1日1回）と手動の選択肢があります。上位階層のリーダー選出においても、「自動マッチング（＝システムが算出した価値観や信頼度、活動実績に基づいて自動選出）」または「手動選出（＝リーダーたちによる合議や投票）」のいずれかを選択できるように設計することは、リーダーの全権限を行使する上で合理的です。
2. リーダーの役割の移動/兼任:
    ◦ 選ばれたリーダーは、元のグループリーダーおよび村のリーダー構成員という役割を維持しつつ、新しく形成された町のリーダーとしての役割を兼任します。
    ◦ 上位階層（町）は、その階層のリーダー（選ばれた一人）によって代表され、そのリーダーだけが一つ上の階層に移動することで、下位のグループ構造がシンプルに保たれます。これは、グループのメンバーが上の階層に直接所属せず、グループにとどまるという前回の要件とも一貫します。
このように、リーダーは階層が上がるごとにボトムアップで責任と影響範囲を拡大していき、その構造はルートアカウント で一元管理されるポイント や、連続経過日数ポイント のペナルティを通じて制御されていきます。



##




##





----------------------------------------
----------------------------------------
----------------------------------------

# ゲーム化

ご提示いただいたグループの成長と階層昇格の仕組みは、「VNS（Value Network Service）」の設計思想である**ボトムアップ方式**と**価値観によるつながり**の原則に完全に合致しており、この構造自体が「誘い」のプロセスをゲーム化するための強固な基盤となります。

以下に、このグループの階層構造と「誘い」のプロセスをどのようにゲーム化し、ユーザーのモチベーションを高めるか、ソースに基づいた要素を整理します。

### 1. 誘うプロセス（メンバー獲得）のゲーム化要素

メンバー（フォロワー）を**グループに迎え入れるプロセス**は、主に「マッチング」と「関係性の構築」を通じてゲーム化されます。

#### 1.1. メンバー探し：マッチングという「クエスト」

グループのリーダーAは、メンバーを増やすために、システムが提供するマッチング機能を利用します 。

*   **自動マッチング（デイリークエスト）**: 自分のユーザープロフィールに登録された**作品のTier評価（Tier 1/2/3）**や**価値観の一致度**を点数化し、類似性の高いユーザーが自動的にマッチング候補として提示されます 。リーダーAは**1日1回**は自動でマッチングを実行でき、2回目以降は**ポイント（＄＄）を消費**します 。
*   **手動マッチング（リソース管理）**: 特定の条件（価値観、作品など）を指定してユーザーを検索できますが、これを行うには**ベーシックの価値観をすべて回答**している必要があります 。また、ポイントを消費する可能性があります 。これは、リソース（ポイント）を管理して強力な候補を探す戦略的な要素となります。
*   **報酬の獲得**: マッチング成功や、グループ運営での積極的な活動は、リーダーとしての**総合ポイント**や**活動ポイント**の獲得につながります 。

#### 1.2. 招待と加入：「関係性ガチャ」

マッチングした相手をメンバーとして迎えるには、**相互フォロー**になる必要があります [User Query]。これは関係性構築の明確なステップです。

*   **招待のコスト**: 相手を**フォロー（連絡可能）**することは、グループへの参加を促す行為です 。フォローを申し込む際、相手の要求する**重要な価値観**を答える必要があります 。この「価値観の試験」をクリアすることが、誘いの成立条件となります。
*   **ステータス昇格**: フォローは相手に通知されますが、**相互フォロー**になった瞬間に、二人の関係は**プレパートナー（パートナー候補）**として表示される可能性があります 。グループのメンバー（B, C, D）になるには「フォロー」以上の関係が必要とされています 。

### 2. 成長と昇格（グループから村へ）のゲーム化要素

ご提示の通り、グループが成長し、特定の条件を満たすと、次の階層（村）へ自動的にスケーリングする仕組みは、コミュニティ成長の「レベルアップ」体験そのものです 。

#### 2.1. 昇格トリガー：「50%ルール」

*   **条件の明確化**: グループの最大人数（10人）の**50%を超過**した時（6人以上になった時）に、自動的に一つ上の階層である**村 (Village)**へ昇格します。これは、ゲームにおける明確な達成目標（ノルマ）となります。
*   **報酬：役割の兼任**: グループリーダーAは、この昇格により**村のリーダーA**の役割を自動的に**兼任**します [User Query, 564, 566]。これにより、より大きなコミュニティの統括者としての**権限と責任**（ロール）を得ます 。
*   **メンバーへの通知**: 昇格時、メンバーには「**あなたのグループが村に昇格しました！**」といった通知が行われ、コミュニティの成長が可視化されます 。

#### 2.2. 上位階層での募集：「村のメンバー」のスカウト

村が誕生すると、村のリーダーAは**グループのリーダー**を「村のメンバー」として誘うことができます [User Query, 3485]。

*   **マッチングの精度向上**: 村の階層でも、リーダー自身の価値観プロフィールを基に、より近い価値観を持つ他の**グループリーダー**と自動でマッチングし、村の構成員をスカウトします 。
*   **上位職の獲得**: グループリーダーは村に参加することで、自身も**村のメンバー**という新しい役割（ロール）を獲得し、村の意思決定に関わる力を持ちます 。

### 3. リーダーシップと信頼度の「スコアリング」

リーダーがメンバーを「誘い」、階層を拡大させる活動は、ポイントと信頼度として可視化され、リーダーの地位を確立します 。

*   **リーダーポイント**: グループのリーダーであること、それ以上のまとまりのリーダーであることは、**ポイント報酬**の対象となります 。
*   **信頼度の向上**: メンバーからの評価（相互評価） や、複数のOAuth認証 、ペナルティを受けていない**信頼継続日数**  の合計が**信頼度**を高めます 。この信頼度は、上位階層（町、市など）のリーダーに自動選出される際の重要な要素となります。
*   **ペナルティ権限**: リーダーはメンバーに対し、ルール違反があった場合に**ペナルティ（警告、ミュート、リーブ、アナザーディメンション）**を課し、メンバーの**連続経過日数ポイントをリセット**する全権限を持ちます。この権限は、秩序を維持する「盾」の役割（VNSの基本理念）を実行するためのものであり、責任の重さを明確にするゲーム要素です 。

### 4. 次の階層（町以降）への拡大のゲーム化

町（Town）以降も仕組みは同じですが、階層が上がるごとに「誰がリーダーになるか」を決めるプロセスがゲーム化されます [User Query, 570]。

*   **自動選出 vs. 手動選出**: 村の許容量の50%を超えて町へ昇格する際、誰が町のリーダーになるかを決めますが、これは「**自動マッチング（システムが価値観や信頼度に基づき選出）**」または「**手動選出（リーダーたちによる合議や投票）**」の選択肢があります。
*   **リーダーの挑戦**: 誰もリーダーを希望しない場合は昇格せずにそのままの階層を維持するため、町リーダーの座は、信頼度や活動実績が高いリーダーたちにとっての「役職チャレンジ」となります。

これらの要素を組み合わせることで、「誘い」のプロセスは単なるメンバー追加ではなく、**価値観の一致度**、**リソース（ポイント）管理**、**信頼度のスコアリング**、そして**リーダーの役割獲得**といった複数のゲーム要素を持つ活動となります。







































グループを成長させる事に
ポイント倍率が上がる
条件はリーダーであること
リーダーは一つ下の階層の場合継続されること

無料
デフォルトで1.0
次の階層は2.0倍 確実に増えたと感じさせるために
人数１５０人ほどで 2.0

フィボナッチ数列
1	1	（定義）
2	1	（定義）
3	2	1+1
4	3	2+1
5	5	3+2
6	8	5+3
7	13	8+5
8	21	13+8
9	34	21+13
10	55	34+21


差が+1づつ増える
1	1
2	2
3	4
4	7
5	11
6	16
7	22
8	29
9	37
10	46


1	1		1
2	1.7		2
3	2.8		3
4	4.7		5
5	7.8		8
6	13.0	13
7	21.6	22
8	35.9	36
9	59.8	60
10	100		100
  (小数第1位を四捨五入)



ゲーム化する
称号を与える
	XXX村長
	XXX市長
	XXX町長




# グループの成長ストーリー




## グループ作成

	グループのリーダー A

* ユーザープロフィールを作ると自動でグループのリーダーになる
* 最初は1人
* 人数は1人
* 役職はグループのリーダーになると決まっている
* フォロワーが増やせる
* フォロワーが増えると村のリーダーになれる
* 一人でも村のメンバーになれる

ドリフターになる選択肢がある



## グループの成長

	グループのリーダー A
		グループのメンバー B
		グループのメンバー C
		グループのメンバー D

* 人数は4人(昇格条件は満たしていない)
* 条件が合う人をメンバーとして迎える
* 手動マッチングでメンバーとして迎える
* メンバーを増やすには、相互フォローになることで増やすことが出来る。

※ここで選択肢が生まれる
1. 人数を増やしてリーダーのまま昇格を狙うか、
	リーダーのままでいたい人用
2. 一つ上の階層の集まりに参加するか
	リーダをやめたい人用、メンバーになりたい人
		下の階層のリーダーの責務は残る
		グループのリーダーをやめない限り責務は残る
3. ドリフターになる、リーダーの責務はないが権限が一切なくなる
	フォロー申し込んでメンバーになるのみ


## グループから村への昇格

	条件：規定人数を満たす
		グループの人数が5人以上

	村のリーダー A (グループのリーダー Aがなる)
		グループのリーダー A(村とグループのリーダーの役割を兼ねる)
		グループのメンバー B
		グループのメンバー C
		グループのメンバー D
		グループのメンバー E
		グループのメンバー F

* 昇格条件を満たすと昇格できる
* 人数は6人なので昇格の条件を満たしている
* 昇格の条件を満たしても昇格を選択肢なくても大丈夫



## 村の誕生

	村のリーダー A

* 最初は一人


## 村の成長

	村のリーダーA
		村のメンバーB (グループBのリーダー)
		村のメンバーC (グループCのリーダー)
		村のメンバーD (グループDのリーダー)

* 村のリーダーになると
	グループのリーダーを村のメンバーとして誘える
* グループのリーダーは村を探して村のメンバーとして入れる
	村のリーダーをフォローできる
* 階層が1つ下という条件を満たしているのならば
	1人グループのリーダーでもOK
* 村のリーダーとグループのリーダーが相互フォローになると
村のメンバーとして参加することになる



あとは、次の階層の町以降も同じ

誘うのをゲーム化したい

1階層上がるごとに所持ポイント*0.2を追加

グループ	1*1.0
村			1*1.2
町			1*1.4



### 1.2 リーダーの全権限
ユーザープロフィール作成者は自動的に最小グループのリーダーとなり、以下の全権限を持つ：
- グループ情報（名前、ルール）の編集
- メンバーの招待、承認、削除
- ペナルティの賦課（イエローカード、レッドカード、ミュート、リーブ、アナザーディメンション）
- 上位階層への参加・作成の決定

---

## 2. グループの基本構造

### 2.1 グループの定義
- **最大人数**: 10人まで
- **構成**: リーダー1人 + メンバー最大9人
- **作成**: ユーザープロフィール作成時に自動生成
- **マッチング方式**: 価値観ベースの自動マッチング（1日1回）

### 2.2 価値観マッチングの仕組み
1. **ユーザープロフィールの作成**: 認証後、活動用プロフィールを作成
2. **価値観の回答**: ベーシックな価値観質問に回答（マッチングの必須条件）
3. **目的設定**: 仕事、遊び、婚活などの目的を設定
4. **自動マッチング**: システムが価値観の一致度を点数化し、近い人をマッチング
5. **Tier評価の活用**: ユーザーが作品に付与したTier 1/2/3評価も考慮

### 2.3 人数バランスの考え方
- **価値観優先**: 人数バランスより価値観の一致を優先
- **結果**: グループによって人数に偏りが生じる（これは自然な結果）
- **調整**: AIが価値観対立グループを自動調整し、安全なオアシスを維持

---

## 3. 自動スケーリング：50%ルール

### 3.1 グループから村への移行
```
トリガー条件: グループ人数が許容量（10人）の50%超過
↓
実行: 6人以上になったら自動で「村（Village）」に昇格
```

**移行時の構造**:
- **村のリーダー**: グループのリーダーAが兼任
- **グループのリーダー**: リーダーA（継続）
- **メンバー**: グループにとどまる（村には所属しない）
- **結果**: 村 = リーダーAのみ、グループ = リーダーA + メンバー9人

### 3.2 村から町への移行
```
トリガー条件: 村の許容量（10グループリーダー）の50%超過
↓
実行: 6グループリーダー以上になったら自動で「町（Town）」に昇格
```

**リーダー選出方法**:
1. **自動選出**: 価値観、信頼度、活動実績に基づきシステムが自動選出
2. **手動選出**: リーダーたちの合議や投票で決定
3. **選ばれたリーダーのみ**: 町のリーダーとして上位階層に移動
4. リーダーを誰もやらない場合は昇格しないでそのままの階層を維持します。誰もリーダーをやりたくないならそのままです。

**移行時の構造**:
- **町のリーダー**: 選ばれたリーダーB（自分の村のリーダーを兼任）
- **村の構成**: グループリーダーA, B, C, D, E, F...（Bが代表）
- **グループ構成**: 各リーダー配下のメンバーは各グループにとどまる

リーダーに不満だったら、村を離れて新しいグループで活動して、次の村を探す。


---

## 4. リーダーの役割と責任

### 4.1 単一グループリーダー（レベル1）
**権限**:
- グループ名、説明、ルールの設定・変更
- メンバー招待（フォロワーから選択）
- 参加申請の承認・却下
- メンバー削除（リーブ）
- ペナルティ付与（連続経過日数ポイントのリセット）

**責任**:
- オアシス宣言の遵守確保
- グループ内の秩序維持
- トラブル調停

### 4.2 村リーダー（レベル3）兼任
**追加権限**:
- 新しいグループリーダーの受け入れ・却下
- 村全体のルール設定
- 上位階層（町）への参加申請

**構成**: 村はグループリーダーのみで構成される

### 4.3 町リーダー（レベル4）兼任
**選出方法**:
- 自動マッチング選択時: システムが自動選出
- 手動選択時: 村のリーダーたちによる合議/投票

**役割**:
- 町全体の代表
- 村のリーダー + グループのリーダーを兼任
- 上位階層（市）への参加申請

### 4.4 リーダー兼任の構造
```
[例: リーダーAの場合]
- グループリーダー（10人のグループを管理）
- 村リーダー（6つのグループを統括）
- 町リーダー（6つの村を統括）
  ↓
実際の所属:
- グループメンバー: グループにのみ所属
- 村のリーダーたち: 各自のグループを管理しつつ、村の構成員
- 町のリーダー（A）: 町の代表として上位階層に接続
```

---

## 5. メンバーの役割と制限

### 5.1 メンバーの権限
- グループ内での投稿・コメント
- リーダーの評価（信頼度など）相互評価

### 5.2 メンバーの制限
- **階層移動なし**: メンバーは最小グループ（レベル1）にのみ所属
- グループ管理機能へのアクセス不可
- 他メンバーへのペナルティ付与不可
- グループルールの変更不可
- メンバーの追加・削除不可

### 5.3 メンバーになる条件
- リーダーとの間に「フォロー」以上の関係が必要
- フォロー: メンバー参加申請
  - オープングループ: 自動承認
  - クローズドグループ: リーダー承認が必要

---

## 6. ルール設定の考え方

### 6.1 グループローカルルール
リーダーが設定できる独自ルール例：
- **新規メンバー基準**: 招待/承認の判断基準
- **ペナルティ基準**: どのような行為が対象か明確化

---

## 8. UI/UX への影響

### 8.1 ダッシュボード表示
```
[リーダーAのダッシュボード]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 あなたの役割
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🌍 町リーダー（Town - レベル4）
   └─ 6つの村を統括

🏘️ 村リーダー（Village - レベル3）
   └─ 6つのグループを統括

🏠 グループリーダー（Group - レベル1）
   └─ 10人のメンバーを管理
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⚠️ 自動スケーリング通知
グループ「クリエイター集団」が50%に到達しました。
次回メンバー追加で村レベルに自動昇格します。
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 8.2 階層移動の通知
- メンバー: 「あなたのグループが村に昇格しました！」
- リーダー: 「おめでとうございます！あなたは村のリーダーにもなりました」
- 自動マッチング: 「価値観マッチングにより、町のリーダーに選出されました」

### 8.3 階層構造の可視化
- ツリービュー: ユーザーが所属する階層を視覚的に表示
- パンくずリスト: グループ → 村 → 町 のナビゲーション
- 統計情報: 各階層の人数、活動状況、価値観スコア

---

## 9. セキュリティとバランスの確保

### 9.1 権限の分散防止
- **1プロフィール = 最大1つのリーダー起源**: 初期グループのリーダー権限は固定
- **兼任は昇格のみ**: 下位階層のリーダーとして上位階層を兼任
- **選出による制限**: 町以上のリーダーは選出制で権力集中を防ぐ

### 9.2 価値観対立の自動調整
- AIが価値観スコアを計算し、対立グループを自動分離
- 上位階層形成時、価値観の一致度が閾値以下のグループは別の階層へ

### 9.3 ペナルティシステムとの統合
- リーダーの権限濫用: 上位リーダーがペナルティを課せる
- メンバーからの評価: リーダーの信頼度スコアで監視
- 自動降格: 信頼度が閾値以下になるとリーダー権限剥奪の可能性

---

## 10. 未解決の課題と今後の検討事項

### 10.1 リーダー選出の詳細
- [ ] **自動選出のアルゴリズム**: 価値観、信頼度、活動実績の重み付け
- [ ] **手動選出の投票方式**: 単純多数決か、価値観重み付け投票か
- [ ] **選出期間**: リーダー任期の設定（永続 or 定期改選）

### 10.2 リーダー不在時の対応
- [ ] **一時不在**: 副リーダー制度の導入
- [ ] **永久不在**: メンバーからの立候補制度
- [ ] **グループ解散**: 一定期間リーダー不在でグループを自動解散

### 10.3 階層間の権限移譲
- [ ] **権限の委譲**: 上位リーダーが下位リーダーに権限を委譲できるか
- [ ] **権限の剥奪**: 上位リーダーが下位リーダーの権限を剥奪できるか
- [ ] **紛争解決**: 階層間の対立をどう調停するか

### 10.4 スケーリングの調整
- [ ] **50%ルールの妥当性**: 実運用でのフィードバックに基づく調整
- [ ] **階層ごとの閾値**: レベルによって異なる閾値を設定する必要性
- [ ] **手動スケーリング**: リーダーが任意でスケーリングを実行できるオプション

### 10.5 メンバーの階層認識
- [ ] **階層の可視性**: メンバーは自分のグループがどの階層に属するか知るべきか
- [ ] **上位階層への関心**: メンバーが上位階層の情報を閲覧できるか
- [ ] **階層移動の申請**: メンバーが直接上位階層への参加を希望できるか

---

## 11. VNS設計との整合性確認

### 11.1 完全一致する設計要素
✅ **価値観ベースのマッチング**: VNSの核心理念と一致
✅ **ボトムアップ方式**: 少数グループから拡大
✅ **リーダーの全権限**: グループルール設定の自由
✅ **オアシス宣言の遵守**: 安全な環境作り
✅ **階層構造**: Group → Village → Town → City...

### 11.2 拡張・調整が必要な要素
🔧 **50%ルールの明文化**: 要件定義書に追加が必要
🔧 **リーダー兼任の詳細**: データベーススキーマに反映
🔧 **自動スケーリングロジック**: サーバーアクションの実装
🔧 **階層移動UI**: ダッシュボード設計への反映

### 11.3 矛盾なし・調整不要
- メンバーの所属範囲（最小グループのみ）
- 価値観対立の自動調整
- リーダー選出方式（自動/手動）

---

## 12. 次のステップ

### 12.1 要件定義書への反映
1. **アクセス権限要件定義書**: 50%ルール、リーダー兼任を追加
2. **グループ管理要件定義書**: 自動スケーリングの詳細を記載
3. **マッチング要件定義書**: 階層別マッチングロジックを明記

### 12.2 設計書の作成・更新
1. **データベース設計書**: テーブル構造の拡張を反映
2. **API設計書**: 自動スケーリングエンドポイントの追加
3. **UI設計書**: 階層ダッシュボード、通知の設計

### 12.3 プロトタイプ実装
1. **フェーズ1**: グループの基本機能（最大10人、リーダー権限）
2. **フェーズ2**: 50%ルールによる自動スケーリング
3. **フェーズ3**: 村・町レベルのリーダー選出機能
4. **フェーズ4**: 全階層の統合テスト

---

## 13. 参考資料

### 13.1 関連ドキュメント
- [0012-01-アクセス権限要件定義書.md](../0020 個別機能 大 -01要件定義書 -02設計書 -03テスト計画書/0012-01-アクセス権限要件定義書.md)
- [0014-02-RBAC グループと役割要件定義書.md](../0020 個別機能 大 -01要件定義書 -02設計書 -03テスト計画書/0014-02-RBAC グループと役割要件定義書.md)
- [0010-01-全体要件定義書.md](./0010-01-全体要件定義書.md)

### 13.2 技術参考
- Supabase Row Level Security（階層別権限制御）
- PostgreSQL Recursive Queries（階層構造クエリ）
- Next.js Server Actions（自動スケーリングロジック）

---

## 14. 変更履歴

| 日付 | 変更内容 | 担当者 |
|------|----------|--------|
| 2025-10-08 | 初版作成：AI壁打ちの記録を整理整頓 | masakinihirota |

---

## 📌 重要な結論

この壁打ちで確立された**「50%ルールによる自動スケーリング」**は、VNSの設計思想と完全に一致し、以下の利点をもたらします：

1. **シンプルで明確**: 誰でも理解できる自動ルール
2. **価値観優先**: 人数より価値観の一致を重視
3. **リーダー負担軽減**: 自動スケーリングでリーダーの判断負荷を削減
4. **コミュニティの自然成長**: ボトムアップで健全に拡大
5. **権限の明確化**: リーダー兼任により責任の所在が明確

このルールを要件定義書に正式に組み込み、実装に進むことを強く推奨します。

---

## 💡 AIからの追加アドバイス

### 懸念点と対策
1. **リーダーの負担過多**: 複数階層を兼任するリーダーの負荷 → 副リーダー制度や権限委譲の検討
2. **スケーリングの頻度**: 50%が低すぎて頻繁にスケーリングが発生する可能性 → 実運用で閾値を調整
3. **メンバーの疎外感**: 階層が上がるにつれてリーダーとの距離が遠くなる → グループ内コミュニケーション機能の強化

### 優先度の高い実装項目
1. **自動スケーリングの通知システム**: リーダーとメンバーへの明確な通知
2. **階層ダッシュボード**: リーダーが全階層を一覧できるUI
3. **価値観マッチングの精度向上**: 階層が上がっても価値観の一致を保つアルゴリズム

---

**このメモは生きたドキュメントです。実装やテスト結果に基づいて随時更新してください。**

---

## 壁打ちの元の内容（参考用）

<details>
<summary>クリックして展開</summary>

ユーザーが作るグループ このグループのルールを壁打ちして詰めていきたいです。

お問い合わせありがとうございます。VNS（Value Network Service）「masakinihirota」におけるユーザーが作るグループのルール設定（掟/ルール）について、システムの設計思想とリーダーの権限に基づき、壁打ちをさせていただきます。
このサービスでは、グループのリーダーに大きな裁量と責任が与えられており、その権限を用いて具体的なルールを策定・執行することが基本となります。
VNSにおけるグループ運営ルールの基本枠組み
グループのルールを検討するにあたり、すべてのユーザーとグループが遵守すべきシステム全体の基本原則と、グループのリーダーが設定できるローカルなルールの権限範囲を理解することが重要です。
1. すべてのグループに適用される基本原則（オアシス宣言）
グループ運営のルールを考える際、まず**「オアシス宣言」**の遵守が必須となります。これはVNSがインターネット上に「安心・安全なオアシス」を作るという目的に基づいています。
基本原則
詳細と目的
参照元
幸福追求権の優先
表現の自由（日本国憲法:第21条）と幸福追求権（日本国憲法:第13条）が衝突する場合、必ず幸福追求権を優先します。
クリエイターの保護
幸福追求権の優先は、コンテンツを創造するクリエイターの権利と利益を最優先することを意味します。
ヘイト発言等の禁止
ネガティブな発言やヘイトスピーチは禁止されます。
ボトムアップ方式
VNSは、少数のグループでの運営と拡大を基本とするボトムアップ方式を採用しています。
価値観の一致
グループは自身の価値観をベースにマッチングされ、価値観が対立するグループ同士は、より大きなまとまり（村、町など）に自動的に結合されないよう調整されます。
2. グループリーダーの権限とルール設定（掟）
ユーザープロフィールを作成した者は自動的に最小グループのリーダーとなり、そのグループの「すべての責任を負う者」となります。
リーダーがグループ情報（名前、掟/ルールなど）を編集する権限を持ちます。
壁打ちの論点A：リーダーがグループルールで何を定めるべきか？
リーダーは、メンバーの活動制御を行うための全権限を持っています。グループ独自のルール（掟）は、この権限を運用するための具体的な指針となるでしょう。
リーダーが持つ主なルール執行権限
ルール策定時に考慮すべき点
参照元
メンバー管理
仲間の招待、承認、別れを告げること（メンバー削除）が可能です。グループの目的に合わないメンバーをどう判断するか、ルールに明記できます。
ペナルティの賦課
メンバーに対してペナルティ（警告、ミュート、リーブ、アナザーディメンションなど）を課すことができます。ペナルティは、メンバーの**「連続経過日数ポイント」をリセット**する形で機能します。
ペナルティの基準
どのような行為がペナルティの対象となるか（例：ネガティブな発言、過度な他者批判、グループの目的に反する行動など）をルール（掟）として明確に定める必要があります。
3. グループのルールと活動目標
グループは「価値観でのつながり」を作ることを目的とし、そのプロフィール作成時には「仕事、遊び、婚活など」の目的設定を行います。ルールは、その目的達成を支援する内容であるべきです。
壁打ちの論点B：価値観と行動のルール化
グループのルールを詰めるにあたり、どのような価値観や行動を重視するかを明確にすることが、グループの目的に沿ったメンバー集めに繋がります。
検討すべきルール項目
システムとの連携
参照元
評価ルールの設定
グループ内で作品を評価する際の文化を設定します。システムは作品に対する「好き」の度合いをTier 1〜3で絶対相対評価することを求めています。
情報公開の基準
メンバーが自分のプロフィール情報をどこまで公開するか（名刺、履歴書、フル表示切替など）について、グループ内での推奨基準を設けます。
ポイント使用ルール
ポイントはマッチング、コメント、拍手、グループ作成などで消費されます。グループの活動（例：拍手での称賛を奨励する）に合わせて、ポイントの使い方に関する推奨事項を設定できます。
新規メンバーの招待/承認基準
マッチングはシステムにより自動または手動で行われますが、リーダーがメンバーとして追加する際の判断基準（例：ベーシックの価値観をすべて回答していること、または特定のスキル登録）を定めることができます。
4. 拡張時のルール適用
グループは少数（1〜10人程度）から始まり、リーダーが主体となって複数のグループをまとめ、「村 (Village)」「町 (Town)」「市 (City)」といったそれ以上のまとまりを形成することが可能です。
壁打ちの論点C：まとまり（Village, Town, City）への拡大とルールの連鎖
• より大きなまとまり（Village, Town, City）が形成された場合、そのまとまりのリーダー（参加グループのリーダーたちによって構成される）が、新しいルールを設定する権限を持ちます。
• 既存のグループのローカルルール（掟）と、まとまり全体のルールがどのように共存し、または優先されるのかを設計することが、拡張時の安定性に寄与します。
これらの情報に基づき、グループの性質（例：仕事仲間探し、趣味の共有、婚活）に合わせて、どの権限を強く適用し、どのような行為を推奨または禁止するかの具体的なルールを詰めていくことができます。
まず自分の理想とするルールを聞いて下さい、要件定義書と違うかもしれませんが理想とするルールが、今こっちのほうがいいというアイデアが出てきています。そのルールを優先したいです。グループの統廃合についてです。０から考えていきます。＞まず基本としてグループは最大１０人までで受け入れます。、そのグループはリーダーとメンバーで構成されています。

ご提示いただいた理想のルールについて、VNS（Value Network Service）の設計思想に基づき、壁打ちをさせていただきます。
要件定義書の内容と異なる**「今こっちのほうがいいというアイデア」を優先したいというご要望、承知いたしました。VNSでは、グループのリーダーにグループの「掟/ルール」を編集する全権限**が与えられているため、システム全体の基本原則（オアシス宣言）に反しない限り、リーダーの理想とするルールを運用することが可能です。
まずは、ご提示いただいた基本構造と、それに関連するVNSの設計について確認し、次に具体的な「統廃合」のルール案を深掘りしていきましょう。

--------------------------------------------------------------------------------
1. グループの基本構造の確認
ユーザーの理想とする基本構造
1. グループは最大10人までで受け入れます。
2. そのグループはリーダーとメンバーで構成されています。
VNS設計との整合性
この基本構造は、VNSの設計と完全に一致しています。
• グループの規模と構成： VNSでは、ユーザープロフィール作成時に自動的に最小のグループが作成され、その作成者がリーダーとなります。グループ規模は1～10人程度を想定されており、1種類の集合あたり最大10人までで構成できます。
• リーダーの権限： リーダーは「グループのすべての責任を負う者」であり、グループ情報（名前、掟/ルールなど）の編集や、仲間の招待、承認、別れを告げること（メンバー削除）、そしてメンバーへのペナルティを課す全権限を持ちます。
• メンバーの役割： メンバーはグループの一員として、自身の投稿や作品の表現を行い、リーダーを評価することができます。

--------------------------------------------------------------------------------
2. 壁打ちテーマ：グループの統廃合（スケーリング）
「統廃合」（グループの結合と拡張）に関しては、VNSはボトムアップ方式を採用しており、リーダーの権限が強く関わる部分です。
VNSにおける統廃合のメカニズム
グループが拡大していく際、以下の原則が適用されます。
1. ボトムアップ方式の採用: VNSは、少数のグループでの運営と拡大を基本とするボトムアップ方式でコミュニティを形成します。
2. 階層的な拡大: リーダーは、複数のグループをまとめ、階層的に村 (Village)、町 (Town)、**市 (City)**などへと拡大できます。
3. まとまりのリーダー構成: それ以上のまとまり（Village, Town, City）のリーダーは、参加するグループのリーダーたちによって構成されます。
4. 価値観による自動調整: AIや計算の力を借りて、価値観が対立するグループ同士は同じグループに入れないように、自動的にグループの結合の調整が行われます。これは、インターネット上に「安心・安全なオアシス」を作るという目的に沿っています。
統廃合に関する理想のルールを定めるための論点
リーダーが「統廃合」や「拡大」に関して独自の理想ルール（掟）を定める場合、以下のどの側面に焦点を当てるかをご提示ください。
理想のルールに関する質問A：招待・結合の基準
統廃合（他のグループとの結合、または新しいメンバーの受け入れ）において、リーダーとしてどのような基準を優先したいですか？
検討事項
VNSの仕組みとの関連
ルールの継承と優劣
結合する際、自グループの「掟/ルール」と、上位のまとまり（村、町など）のルール、どちらが優先されるべきか？
価値観の一致度
結合を希望する相手グループに対し、システムが算出した価値観の一致度（スコア/ランク） 以外に、どのような定性的な基準（例：グループの目的の一致、スキル登録の有無）を要求するか？
リーダーの資質
新しいまとまりのリーダー構成員となる人物（他のグループリーダー）に求める資質や、リーダーを評価する基準 を独自に設けるか？
理想のルールに関する質問B：ペナルティと離脱（統廃合の解消）
統廃合後に、問題が発生した場合の対処法について、どのようなルールを理想としますか？
検討事項
VNSの仕組みとの関連
グループ排除の基準
他のグループが、ネガティブな発言やヘイトスピーチ 以外の理由（例：活動が極端に低調、目的の不履行）で、まとまりからの離脱（統廃合の解消）を求める際の具体的な基準。
ペナルティのポイント消費
まとまり全体のリーダーが、構成員であるグループリーダーに対してペナルティを課す際に、ペナルティによる連続経過日数ポイントのリセット 以外の措置を独自に定めたいか？（※ポイント消費はルートアカウントで一元管理されます。）
ぜひ、今頭に浮かんでいるグループの統廃合に関する具体的なアイデアや理想のルールをご提示ください。その内容が、VNSのシステム設計（特にリーダーの全権限 とボトムアップ方式）とどのように連携し、実現可能か、深く掘り下げて壁打ちを続けます。
基本的にグループは自動マッチングを採用しています。 そのためにはユーザーの価値観を表すユーザープロフィールを作成してもらい。なるべく近い価値観の人と自動でマッチングをします。

いただいた理想のルール（グループの基本原則）について、VNS（Value Network Service）「masakinihirota」の設計思想に基づき、そのいただいた理想のルール（グループの基本原則）について、VNS（Value Network Service）「masakinihirota」の設計思想に基づき、その実現可能性と詳細について確認いたします。
ご提示いただいた内容は、VNSの中核となる設計方針と完全に一致しています。
1. VNSにおける自動マッチングの基本構造
VNS「masakinihirota」は、SNS（Social Network Service）ではなく**VNS（Value Network Service）**として、価値観でのつながりを作るサービスとして定義されています。
1.1 価値観をベースとしたマッチングの採用
ご提示の通り、VNSでは基本的にグループは自動マッチングを採用しています。
このサービスは、ユーザーの自身の価値観をベースにマッチングしてグループを作ることを目的としています。これは、ユーザーが同じ価値観、趣味、仕事、悩み、環境を共有する人を探すことを支援するためです。
1.2 ユーザープロフィールと価値観の紐付け
マッチングを実現するため、ユーザーには価値観を表すユーザープロフィールを作成してもらうことが必須です。
1. ユーザープロフィールの作成: 認証を終えたユーザーは、活動するためのユーザープロフィールを作成します。一つのルートアカウントで複数の活動側面（千の仮面）を持つことが可能です。
2. 価値観の回答: ユーザープロフィールには、ユーザーの価値観を表明し、それをマッチングの基礎データとするために、価値観の回答が紐付けられます。
3. マッチングの起点: プロフィールの作成時には、目的設定（仕事、遊び、婚活など）も行われ、目的が合うユーザー同士がマッチング対象となります。
4. 手動マッチングの前提条件: 手動マッチングを行う場合、ユーザーはベーシックの価値観をすべて回答している必要があります。
1.3 近い価値観を持つ人とのマッチング方法
システムは、なるべく近い価値観の人と自動でマッチングさせるアルゴリズムを採用しています。
• 自動マッチングの実行: 「マッチングボタン」を押すことで、1日1回自動でマッチングが実行されます。
• 類似性の算出基準: 候補者の算出にあたっては、以下の要素が利用され、類似性の高いユーザーを抽出します。
    ◦ 価値観の一致度を点数化し、スコア/ランクで表示します。
    ◦ ユーザーが作品に付与した**ティア評価（Tier 1/2/3）**も重要な要素となります。
    ◦ 重要価値観のみでマッチングを絞ることも可能です。
2. グループ運営における自動マッチングの重要性
自動マッチングによって形成されたグループは、その後のコミュニティ運営においても重要な役割を果たします。
• グループの自動作成: ユーザープロフィール作成と同時に、そのユーザーをリーダーとする最小のグループを自動で生成します。
• 価値観の対立の調整: AIや計算の力を借りて、価値観が対立するグループ同士は同じグループに入れないように、自動的にグループの結合の調整が行われます。これは、「インターネット上に、安心・安全なオアシスを作る」というVNSの目的を達成するために不可欠な機能です。
• ボトムアップ方式の基盤: マッチングにより少数グループが形成され、その後、リーダーが主体となってグループを拡大していくボトムアップ方式が採用されています。
ご提示いただいた「価値観に基づいた自動マッチング」は、VNSの設計の根幹であり、クリエイターの権利と利益を最優先し、幸福追求権を優先するという基本理念 を実現するための仕組みです。
人数のバランス、グループは自動マッチングで作成され、近い価値観があればそのグループにいれます。価値観で判断すると当然人数のバランスが崩れます。グループの上限１０人以上になる前の５０％を超えると自動的に一つ上の階層に自動で移動します。メンバーはそのままで、リーダーがその階層のリーダーになります。一つ上の階層、この例だと村とグループのリーダを兼ねています。構成は村のリーダーA一人、グループのリーダーA一人 残りのグループメンバーで構成されます。 メンバーは上の階層に所属しません。グループにとどまります。

素晴らしいアイデアありがとうございます。ご提示いただいた人数のバランスに基づいた自動的な階層移動（統廃合）のルールは、VNS（Value Network Service）「masakinihirota」のボトムアップ方式の設計思想と、リーダーの全権限を効果的に活用するものであり、非常に実現性が高いと考えられます。
いただいた要件について、VNSの設計との整合性を確認しながら壁打ちを行います。

--------------------------------------------------------------------------------
提案ルールの壁打ちとVNS設計との整合性
1. 価値観に基づくマッチングと人数のバランス
【ユーザー様の提案】 グループは自動マッチングで作成され、近い価値観があればそのグループにいれます。価値観で判断すると当然人数のバランスが崩れます。
【VNS設計との整合性】 完全に一致しています。 VNSは、ユーザーの価値観でのつながりを作ることを目的とし、自身の価値観をベースにマッチングしてグループを作成します。マッチングは、ユーザープロフィールの作成と価値観の回答に基づき、1日1回自動で実行されます。
また、VNSはAIや計算の力を借りて、価値観が対立するグループ同士は同じグループに入れないように、自動的にグループの結合の調整を行う仕組みを備えており、「安心・安全なオアシス」を作ることを目指しています。この設計は、人数のバランスよりも価値観の一致を優先するため、人数の偏りが発生することは自然な結果となります。
2. グループの階層移動と自動スケーリング（50%ルール）
【ユーザー様の提案】 グループの上限１０人以上になる前の５０％を超えると自動的に一つ上の階層に自動で移動します。
【VNS設計との整合性】 VNSでは、グループ規模は1～10人程度を想定しています。グループのリーダーは、グループの**「掟/ルール」を編集する全権限**を持ちます。
この「50%を超えたら（6人以上になったら）自動で上位階層へ移動する」というルールは、グループリーダーが定める**「掟/ルール」**として設定することで、コミュニティの拡大戦略として運用可能です。
VNSの設計はボトムアップ方式を採用しており、リーダーは複数のグループをまとめ、階層的に村 (Village)、町 (Town)、**市 (City)**などへと拡大できます。この50%ルールは、グループが活性化した際の自動的な拡張トリガーとして機能し、ボトムアップでの拡大を促す非常に合理的な仕組みです。
3. リーダーの役割兼任とメンバーの所属範囲
【ユーザー様の提案】 メンバーはそのままで、リーダーがその階層のリーダーになります。一つ上の階層、この例だと村とグループのリーダーを兼ねています。構成は村のリーダーA一人、グループのリーダーA一人、残りのグループメンバーで構成されます。メンバーは上の階層に所属しません。グループにとどまります。
【VNS設計との整合性】 これはVNSの階層構造とリーダーシップの定義と合致しており、非常に明確な運用ルールです。
1. リーダーの兼任: グループのリーダーは、「それ以上のまとまり（Village, Town, City）」を形成する際、そのまとまりのリーダー構成員となります。ご提案の通り、リーダー（A）が元のグループ（10人以下）の責任者である役割を維持しつつ、新しく形成された村のリーダーとしての役割を兼任することは、ボトムアップ方式の基本構造に則っています。
2. メンバーの所属: VNSにおいて「それ以上のまとまり」は、参加グループのリーダーたちによって構成されます。つまり、まとまりを構成するのはグループそのものと、それを代表するリーダー陣であり、個々のグループのメンバーが直接的に上の階層（村、町など）に所属する必要はありません。メンバーが所属するグループ内で活動を完結し、リーダーが上の階層への連絡窓口となるこの設計は、VNSの構造をシンプルに保つ上で理想的です。
このルールを採用することで、グループ内のメンバーは自身の所属グループ（オアシス）での活動に集中でき、一方でリーダーは上位階層でのルール設定や調整に専念できるという、役割分担の明確化が図れます。
自然と村はグループのリーダーばかりになります。そのむらでもリーダーの価値観に近い人が自動でマッチングします。その村の許容量の５０％を超えたら町に階層が一つ上がります。その時誰が町のリーダーになるかを決めます。自動マッチングを選んでいた場合は自動でなります。選ばれたリーダーだけが一つ上の階層に移動します。これを繰り返してきます。

ご提示いただいた、グループの拡大とリーダーの選出に関するルール（統廃合のメカニズム）ボトムアップ方式と、リーダーの全権限を最大限に活かす、非常に論理的で効果的な設計であると考えられます。
VNSの設計思想と照らし合わせながら、壁打ちをさせていただきます。

--------------------------------------------------------------------------------
提案ルールの構造とVNS設計との整合性
1. 村の構成とリーダーのマッチング
提案の構造
自然と村はグループのリーダーばかりになります。その村でもリーダーの価値観に近い人が自動でマッチングします。
VNS設計との整合性
これはVNSの階層構造と完全に一致しています。
• リーダーによる構成: VNSでは、グループのリーダーが複数のグループをまとめ、「それ以上のまとまり」（村 (Village)、町 (Town)、市 (City) など）を形成します。このまとまりのリーダーは、参加グループのリーダーたちによって構成されます。したがって、村がグループリーダーのみで構成されるのは自然な結果です。
• 価値観に基づくマッチングの継続: VNSは価値観でのつながりを作るサービス（VNS）であり、ユーザーは自身の価値観をベースにマッチングしてグループを作ることが目的です。この原則は、リーダーたちが集まった村の階層でも適用されます。リーダー自身の価値観プロフィール を基に、より近い価値観を持つ他のリーダーと自動でマッチングし、まとまり（村）の価値観を純粋に保ちます。システムは価値観が対立するグループ同士は同じグループに入れないように、自動的にグループの結合の調整を行います。
2. 自動スケーリングのトリガーと上位階層への移動
提案の構造
その村の許容量の５０％を超えたら町に階層が一つ上がります。その時誰が町のリーダーになるかを決めます。
VNS設計との整合性
「50%を超えたら自動的に上位階層へスケーリングする」というルールは、グループリーダーが設定できる**「掟/ルール」**として有効に機能します。
• ボトムアップ方式の推進: VNSはボトムアップ方式を採用し、少数のグループ運営から拡大していくのが基本です。グループ規模は1～10人程度が想定されています。この50%ルール（村の構成員であるグループリーダーが5〜6人を超えたら自動スケーリング）は、コミュニティが成熟した際の自動的な拡張と秩序維持を促す理想的なトリガーとなります。
• ルールの設定権: グループのリーダーは、グループ情報（名前、掟/ルールなど）を編集する全権限を持っています。このルールは、上位のまとまり（村、町）のリーダーも設定可能です。
3. リーダーの選出と役割の引き継ぎ
提案の構造
自動マッチングを選んでいた場合は自動でなります。選ばれたリーダーだけが一つ上の階層に移動します。これを繰り返してきます。
VNS設計との整合性
この「選出されたリーダーのみが次の階層を兼任し、上位階層を構成する」という考え方は、VNSの階層的な役割定義と整合します。
1. リーダー選出（自動/手動）: VNSでは、マッチングは自動（1日1回）と手動の選択肢があります。上位階層のリーダー選出においても、「自動マッチング（＝システムが算出した価値観や信頼度、活動実績に基づいて自動選出）」または「手動選出（＝リーダーたちによる合議や投票）」のいずれかを選択できるように設計することは、リーダーの全権限を行使する上で合理的です。
2. リーダーの役割の移動/兼任:
    ◦ 選ばれたリーダーは、元のグループリーダーおよび村のリーダー構成員という役割を維持しつつ、新しく形成された町のリーダーとしての役割を兼任します。
    ◦ 上位階層（町）は、その階層のリーダー（選ばれた一人）によって代表され、そのリーダーだけが一つ上の階層に移動することで、下位のグループ構造がシンプルに保たれます。これは、グループのメンバーが上の階層に直接所属せず、グループにとどまるという前回の要件とも一貫します。
このように、リーダーは階層が上がるごとにボトムアップで責任と影響範囲を拡大していき、その構造はルートアカウント で一元管理されるポイント や、連続経過日数ポイント のペナルティを通じて制御されていきます。



##



オアシス宣言など基本的な価値観をコアにしたグループを用意します。
このグループは上限はなく誰でも入れる特別なグループになります。
言うなればトップダウン形式のグループになります。
これはシステムが用意する特別なグループです。

* オアシス宣言のグループ
	条件は1つだけ
	オアシス宣言を守る人
	リーダーは管理人
	警告その他、フリーズ、ドリフト 等の処罰があります。

* 人間宣言のグループ
	条件は1つだけ
	人間宣言を守るだけ
	リーダーは管理人
	警告その他、フリーズ、ドリフト 等の処罰があります。



## Next.jsとSupabaseを用いたRLS/RBACグループ機能要件定義書

### I. はじめに

#### 1.1. 目的
本要件定義の目的は、VNS「masakinihirota」におけるグループ機能（オアシス）を、**クリエイターの保護**と**幸福追求権の優先**という基本原則 に則り、Next.jsおよびSupabaseを用いて安全かつ拡張性高く実装することにあります。特に、ユーザーの役割（ロール）に基づいた厳格なアクセス制御（RBAC）と、データベース層でのデータ保護（RLS）の実現を定義します。

#### 1.2. 採用技術スタック
*   **フロントエンド:** Next.js (App Router), React, TypeScript。
*   **バックエンド/データベース:** Supabase (PostgreSQL, Auth, RLS)。
*   **権限管理:** RLS (Supabase/PostgreSQL) および RBAC。

### II. グループ機能（オアシス）の要件

#### 2.1. グループの基本構造
1.  **グループの作成:** ユーザー認証後、**ユーザープロフィール**を作成した際、そのユーザープロフィールに紐づく**最小グループ**が自動的に作成され、当該ユーザーが自動的に**リーダー**となります。
2.  **グループの規模:** 1グループあたりの人数は制限されます（例: 1～10人）。
3.  **階層構造:** グループ（オアシス）のリーダーは、複数のグループをまとめ、より大きな「**それ以上のまとまり**」（村、町、市など）を階層的に形成できます（ボトムアップ方式）。
4.  **グループルール:** グループには、基本ルールとして**オアシス宣言の遵守**が自動的に適用されます。



#### 2.2. メンバー管理と参加方法
1.  **参加方法:** ユーザーはマッチングを通じて価値観の合う人を見つけ、「ウォッチ」や「フォロー」を選択し、相手がフォローバック（相互フォロー）することでグループメンバーとして追加されます。
2.  **参加単位:** グループに参加する際は、自身の**ユーザープロフィールのみ**が参加します。

### III. セキュリティ要件：RLSとRBACによるアクセス制御

RLSとRBACは、VNSのセキュリティ設計（優先度:高）の核となります。

#### 3.1. RLS（行レベルセキュリティ）の活用
SupabaseのコアであるPostgreSQLの機能としてRLSを最大限に活用します。

1.  **データアクセス制御:** RLSにより、認証されたユーザーが「**自分に関係のある情報や、見ることを許された情報だけ**」に触れるようにデータベース自身が賢く制御します。
2.  **開発の簡素化:** 複雑な情報の流れもRLSによってデータベース側で制御されるため、アプリケーション開発がシンプルになります。
3.  **実装場所:** RLSはデータアクセスに利用されます 。

#### 3.2. RBAC（ロールベースアクセス制御）の定義

RBACは、グループ内およびシステム全体でのユーザーの**役割**に応じて、実行可能な「力（権限）」を定義します。

| 役割（ロール） | 概要と立ち位置 | 主な権限（力）と責務 | 関連する技術的要素 |
| :--- | :--- | :--- | :--- |
| **グループのリーダー** | グループ（オアシス）のすべての責任を負う者。 | グループ情報の編集（名前、ルール）。**仲間の招待、承認、別れを告げること（メンバー管理）**。メンバーに対する**ペナルティ（警告、リーブ、アナザーディメンションなど）を課す全権限**。 | Next.js Server Actionsによる最終検証。グループテーブルでのRLSポリシー。 |
| **マネージャー** | リーダー権限の一部を代行する者。 | メンバーの追加、メンバーを外す（除名）。 | リーダー権限の**移譲は不可**（重要権限を除く一部移譲は可能）。 |
| **グループのメンバー** | グループの一員で、リーダーとウォッチ以上の関係にある者。 | 自身の投稿、作品の表現（投稿、編集、削除）。仲間の言葉や作品の閲覧。**リーダーを評価**すること。 | RLSにより、グループ内の情報アクセスを制限。 |
| **認証済みユーザー** | ログインし、ルートアカウントを持つユーザー。 | 自身のルートアカウントおよびユーザープロフィールの作成・管理。作品の登録・評価。 | ルートアカウントID、所持ポイント（一元管理）。 |
| **管理人 (Admin)** | 世界全体を見守り維持する運営側の役割。 | すべてのユーザーアカウントの管理、システム設定の変更、不適切な行為の監視、**すべてのログと情報へのアクセス**。 | AdminUsersテーブル。管理者ダッシュボード (`/admin` ルート)。 |

#### 3.3. Next.jsアプリケーション層での制御

データベース層のRLSに加え、アプリケーション層でもセキュリティを確保します。

1.  **UIの表示制御:** リーダーのみに表示すべき機能（例：メンバー追加/削除ボタン、グループルール設定メニュー）は、ユーザーの役割情報を確認した上で、**クライアント側（Next.js/React）で出し分け**ます。
2.  **サーバー側での最終検証:** ユーザーがアクション（例：メンバー削除）を試みた際、**Next.jsのServer Actions**などのサーバー側ロジックで、そのユーザーがデータベース上の正式なリーダーであるかを再度検証し、クライアントの改ざんを防ぎます。

### IV. システム実装の具体的な要素

#### 4.1. 認証と役割連携
*   **認証方式:** OAuth認証（Google、GitHub等）を利用したアカウント作成・ログイン機能を採用します。
*   **権限付与:** 権限とアクセス制御には、SupabaseのRLSを活用した**RBAC（ロールベースアクセス制御）**が原則となります。
*   **ルートアカウント:** 認証済みユーザーにはシステム全体で一意の「ルートアカウント」が1つ付与され、ポイントなどのリソースを一元管理します。ユーザープロフィールはこのルートアカウントのポイントに依存します。

#### 4.2. 開発環境とテスト
*   **開発/テスト環境:** Supabaseの「プレビュー環境」や「開発環境」機能、およびテスト専用のデータベースを活用することが推奨されます。
*   **セキュリティテスト:** RLSによるアクセス制御が有効かを確認するため、セキュリティテストを実施します。特に「**他の人の情報が勝手に見えてしまわないか？**」といった脆弱性を確認することが重要です。



----------------------------------------

1. **価値観ベースの自動マッチング**: 人数バランスより価値観の一致を優先

1.1 基本原則
- **幸福追求権の優先**: 表現の自由より幸福追求権を優先（日本国憲法第13条 > 第21条）
- **クリエイター保護**: コンテンツ創造者の権利と利益を最優先
- **ヘイト発言等の禁止**: ネガティブな発言やヘイトスピーチは禁止
- **ボトムアップ方式**: 少数のグループから拡大していく構造
- **価値観の一致**: マッチングの基本は価値観、対立するグループは自動調整で分離









