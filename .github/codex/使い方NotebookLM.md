ソース

https://github.com/openai/openai-cookbook/blob/main/articles/codex_exec_plans.md

お客様が追加されたソース（`codex_exec_plans.md`の実際のコンテンツ）に基づき、この計画文書の**目的、設定方法、そして具体的な利用手順（計画の書き方）**について包括的にご説明します。

`PLANS.md`（または`codex_exec_plans.md`）は、**Codex**や**`gpt-5-codex`モデル**などのコーディングエージェントが、**複数時間にわたる大規模で複雑なタスク**を成功裏に完了させるために誘導するための、**徹底したデザイン文書**として機能します。

## 1. エージェントへの設定方法

`PLANS.md`をエージェントに利用させるためには、まずリポジトリ内でエージェントの振る舞いを定義する`AGENTS.md`ファイルを更新する必要があります。

1.  **計画ドキュメントの追加:** リポジトリに`PLANS.md`（または`articles/codex_exec_plans.md`などの具体的なファイル）を追加します。
2.  **`AGENTS.md`の更新:** `AGENTS.md`内で、計画を使用するタイミングを記述し、計画の略称（例: **ExecPlan**）を定義します。
3.  **略称の使用:** この略称は任意ですが、Codexに特定の計画の定義を指示するためにプロンプト内で使用できます。

**`AGENTS.md`の例**:
```md
# ExecPlans

When writing complex features or significant refactors, use an ExecPlan (as described in .agent/PLANS.md) from design to implementation.
```

## 2. 実行計画（ExecPlan）の作成と運用ルール

ExecPlanは「**生きている文書（living document）**」であり、「**完全な初心者**」（またはステートレスなエージェント）がそれに従うだけで作業を完了できるように設計されなければなりません。

### A. 非交渉の要件 (NON-NEGOTIABLE REQUIREMENTS)

ExecPlanを作成する上で、以下の要件を必ず満たす必要があります。

*   **完全な自己完結性（Self-contained）:** 現在の形式で、**すべての知識と指示**を含んでいる必要があります。エージェントには**以前の計画の記憶や外部コンテキストがない**ことを前提とします。
*   **最新性の維持:** 貢献者は、進捗、発見、設計上の決定が行われるたびにExecPlanを改訂する必要があります。
*   **機能する動作の提供:** 単に「定義を満たす」コード変更ではなく、**実証可能で動作する振る舞い**を生み出さなければなりません。
*   **用語の定義:** 使用する専門用語（term of art）はすべて平易な言葉で定義するか、使用を避ける必要があります。
*   **外部参照の禁止:** 知識が必要な場合は、外部のブログやドキュメントを指さず、**計画自体に埋め込む**必要があります。

### B. 計画の記述方法とフォーマット

*   **形式:** ExecPlanは、通常、単一のフェンスで囲まれたコードブロック（ラベルは`md`）として記述されます（ただし、ファイルの内容がその単一のExecPlanのみである場合は、トリプルバッククォートを省略します）。
*   **プロンプト:** 文書作成時、読者（エージェント）を**このリポジトリの完全な初心者**として扱う必要があります。
*   **目的を最初に:** 作業の目的と意図が最初にきます。ユーザーの視点から、その変更がなぜ重要か、何ができるようになるか、そして**動作していることをどのように確認できるか**を数文で説明します。
*   **具体的なステップ:** 編集する場所、実行するコマンド、観察すべき結果など、正確なステップで読者（エージェント）を導きます。
*   **コミットと進捗:** エージェントは**頻繁にコミット**し、すべての停止点で`Progress`セクションの項目を追加・分割し、進捗を肯定的に記録します。

## 3. 計画の骨格（Skeleton of a Good ExecPlan）

ExecPlanは厳格な構造を持っています。特に、`Progress`、`Surprises & Discoveries`、`Decision Log`、`Outcomes & Retrospective`のセクションは**必須**であり、作業の進行に合わせて更新し続ける必要があります。

| セクション名 | 内容と役割 | 重要なポイント |
| :--- | :--- | :--- |
| **`# <Short, action-oriented description>`** | 短く、行動志向の説明。 | |
| **`## Purpose / Big Picture`** | ユーザーがこの変更から何を得るか、そしてそれをどのように確認できるかを説明。 | |
| **`## Progress`** | **チェックボックス付きのリスト**を使用して、詳細なステップを要約。停止するたびに、完了したタスクと残りのタスクを記録。 | タイムスタンプを使用することが推奨されます。 |
| **`## Surprises & Discoveries`** | 実装中に発見された予期せぬ挙動、バグ、最適化、洞察を短い証拠スニペットとともに文書化。 | |
| **`## Decision Log`** | 計画作業中に行った**すべての重要な設計上の決定**とその理由（Rationale）を記録。 | |
| **`## Outcomes & Retrospective`** | 主要なマイルストーンまたは完了時に、達成されたこと、残った課題、学んだ教訓を要約。 | |
| **`## Context and Orientation`** | 読者（エージェント）が何も知らないと仮定して、タスクに関連する現在の状態を説明。キーファイルとモジュールを**フルパスで**指定。 | |
| **`## Plan of Work`** | 編集と追加の順序を散文で記述。ファイル名、関数、モジュール、変更内容を具体的に記述。 | |
| **`## Concrete Steps`** | 実行する**正確なコマンド**と実行場所（作業ディレクトリ）を明記。予想される出力のトランスクリプトも示し、読者が比較できるようにする。 | |
| **`## Validation and Acceptance`** | **検証はオプションではありません**。システムを起動または実行する方法、および**観察すべき動作**を記述。検証を「テストコマンドを実行し、新しいテスト<name>が合格する」といった形で、人が検証できる行動として表現。 | |

## 4. 複数の計画の利用方法（会話履歴より）

もしリポジトリ内に複数のExecPlanが存在する場合は、以下の方法でエージェントを指示します。

*   **計画を名前で指定:** エージェントに対して、**実装すべき計画を名指しで指示する**べきです。
*   **トークン消費の回避:** この方法により、エージェントがリポジトリ内のすべての計画を読み込み、どれがアクティブかを判断する必要がなくなり、**トークンの浪費を避ける**ことができます。
