---
name: generateTddInstructions
description: 対象機能のTDD指示書を設計書に基づき生成する
argument-hint: "[対象機能名] [設計書パス] (任意:テストリストパス)"
---
以下の要件に厳密に従い、指定された対象機能の TDD（テスト駆動開発）指示書を日本語で生成してください。回答は必ず対象機能のみを扱い、他機能・全体要件の再掲・冗長な一般論を含めないこと。

入力パラメータ:
- [対象機能名]: 例「アクセス権限管理」「RBACロール更新」など。単一機能に限定。
- [設計書パス]: 対象機能の設計/要件定義ドキュメント（例: `vns-masakinihirota-design/0020 個別機能 大 -01要件定義書 -02設計書 -03テスト計画書/0012-02-アクセス権限設計書.md`）。
- (任意) [テストリストパス]: 既存テストケース一覧（なければ新規作成方針を示す）。
- 環境/スタックは本プロジェクト標準（Next.js, React, Vitest, Testing Library, Drizzle ORM, Supabase, Biome）を前提とし必要部分のみ抜粋。

出力構成（見出し順）:
1. 概要: 対象機能のテスト対象範囲（1段落）。
2. 前提条件: 使用スタック・参照すべき設計書セクション（箇条書き）。
3. TDD進行ステップ: Red→Green→Refactor の具体的手順（機能固有の粒度）。
4. テスト観点マップ: 分類 (機能正常 / 権限 / 境界 / 異常 / 非機能関連) と各カテゴリの意図。
5. 最小 Red セット案: 最初に書く 2〜5 件のテストケース（ID, 目的, 種別 Unit/Integration, 簡潔な期待結果）。
6. 追加拡張ケース: カバレッジ向上のため後追いで追加すべき分岐・エッジ（重複禁止）。
7. モック/スタブ方針: DB/Supabase/API/時間/認証など対象機能で必要な抽象化戦略。
8. ディレクトリ/ファイル配置ガイド: 推奨パス例 (`tests/[feature]/...`) と主なファイル名・責務。
9. 品質ゲート: カバレッジ目標 (例: 主要分岐100% / 全体80% など) と失敗時対処フロー。
10. コミット粒度指針: どこで Red / Green / Refactor を分けるか。
11. リファクタ観点: 想定される重複/抽象化ポイントと時期（早すぎる最適化禁止）。
12. 次アクション: この指示書を受けて最初に実行する具体的コマンド/作業（PowerShell コマンドを `pwsh` コードブロックで）。
13. Tips: 対象機能に特有の注意点（1〜3項目）。

制約:
- 冗長な一般的TDD説明は1回のみに留める（詳細は既知と仮定）。
- 各テストケース記述は 2 行以内を目安（簡潔性優先）。
- 他機能・全体要件・用語集の丸写し禁止。必要なら参照名のみを挙げる。
- 不明な仕様がある場合は「未確定: ○○の仕様確認が必要（想定: ...）」と明示し推定で突き進まない。

スタイル:
- 箇条書きは過度な入れ子禁止。番号付き/ハイフンのシンプル表現。
- 日本語・敬体でなく常体（ですます不要）。
- コード/コマンドは `pwsh` ブロック。識別子/パスはバッククォート。

例外対応:
- 設計書にテスト観点が未定義なら、機能目的から導出した仮観点を明示し「仮」タグを付ける。
- テストリストが未作成なら、新規ファイル命名規則案を提示（`[機能ID]-03-[対象機能名]テストリスト.md`）。

最終行に短い追加 Tips（汎用）を 1 行: 「小さいRed→小さいGreen→速い改善が速度と品質を両立。」

出力はこのプロンプト仕様だけに従い、追加の前置きや謝辞を入れない。

入力例:
`アクセス権限管理 vns-masakinihirota-design/0020 個別機能 大 -01要件定義書 -02設計書 -03テスト計画書/0012-02-アクセス権限設計書.md vns-masakinihirota-design/0020 個別機能 大 -01要件定義書 -02設計書 -03テスト計画書/0012-03-アクセス権限テストリスト.md`

さあ、指定された対象機能にだけ集中して TDD 指示書を生成せよ。
